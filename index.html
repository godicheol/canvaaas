<!DOCTYPE html>
<html>
<head>
<title>canvaaas</title>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- ! -->
<meta name="viewport" content="width=device-width, initial-scale=1"> 
<link rel='stylesheet' href='./dist/canvaaas.css' />
<script src="./dist/canvaaas.js"></script>
<!-- ! -->

<style>
	html,
	body,
	div{
		margin: 0;
		padding: 0;
	}

	#myContainer{
		margin-top: 27px;
		padding: 24px;
		overflow: hidden;
		/*background-color: #000;*/
	}

	#myCursor,
	#myImage,
	#myCanvas{
		/*color: #FFF;*/
		/*background-color: #000;*/
		/*border-top: 1px solid black;*/
		font-size: 0.8rem;
		padding: 3px 24px;
	}

	#myCursor.hidden,
	#myCanvas.hidden,
	#myImage.hidden{
		display: none;
	}

	#myCursor-id{
		float: left;
	}
	#myCursor-state{
		float: right;
	}

	#myCanvas-filename{
		float: left;	
	}
	#myCanvas-editabled{
		float: right;
		margin-right: 6px;
	}
	#myCanvas-backgroundColor{
		width: 1rem;
		height: 1rem;
		margin-right: 6px;
		outline: 1px solid black;
		float: right;
	}
	#myCanvas-state{
		float: right;
	}

	#myImage-id{
		float: left;
	}
	#myImage-state{
		float: right;
	}

	input[type='file']{
		display: none;
	}
	label,
	button{
		font-family: arial;
		padding: 3px 6px;
		font-size: 14px;
		border: 1px solid #777;
		border-radius: 2px;
		background-color: #e7e7e7;
		cursor: pointer;
	}
	label:hover,
	button:hover{
		background-color: #c7c7c7;
	}
	label:active,
	button:active{
		background-color: #e7e7e7;
	}

	.header{
		position: absolute;
		top: 0;
		left: 0;
		right: 0;
		font-size: 0;
		font-family: sans-serif;
		/*border-bottom: 1px solid black;*/
	}
	.header-hidden{
		display: none;
	}
	.header-tab{
		position: relative;
		display: inline-block;
		vertical-align: top;
		width: auto;
	}
	.header-subject{
		display: block;
		color: inherit;
		text-decoration: none;
		font-size: 0.8rem;
		font-weight: 700;
		padding: 6px 12px;
		cursor: default;
	}
	.header-tab:hover .header-subject{
		background-color: #e7e7e7;
	}
	.header-list{
		position: absolute;
		list-style: none;
		min-width: 150px;
		margin: 0 6px;
		padding: 6px 6px;
		background-color: #171717;
		max-height: 500px;
		z-index: 999;
		overflow-y: auto;
	}
	.header-list.hidden{
		display: none;
	}
	.header-list a,
	.header-list label{
		display: block;
		color: #e7e7e7;
		text-decoration: none;
		padding: 6px 6px;
		margin: 0px;
		cursor: default;
		background-color: rgba(0,0,0,0);
		border: 0;
		border-radius: 0;
		font-size: 0.8rem;
	}
	.header-list a:hover,
	.header-list label:hover{
		background-color: #373737;
	}
	.header-list li.rule{
		margin: 6px;
		border-top: 1px solid #575757;
		color: #e7e7e7;
	}
</style>
</head>
<body style="padding-top: 0; padding-bottom: 0;">

	<div id="header" class="header">
		<div class="header-hidden">
			<input id="uploadSingle" type="file" onchange="canvaaas.uploadFile(this.files)" accept="image/*">
		</div>
		<div class="header-tab">
			<a href="javascript:void(0)" class="header-subject">Canvaaas.js</a>
			<ul class="header-list hidden">
				<li><a href="javascript:void(0)" onclick="alert('Created by eeecheol@gmail.com')">About Canvaaas</a></li>
			</ul>
		</div>
		<div class="header-tab">
			<a href="javascript:void(0)" class="header-subject">File</a>
			<ul class="header-list hidden">
				<li><a href="javascript:void(0)" onclick="
					canvaaas.newCanvas({
						width: window.prompt('Type width', '6'),
						height: window.prompt('Type height', '4'),
						unit: window.prompt('Type unit', 'in'),
						dpi: window.prompt('Type dpi', '300'),
					}, function(err, res){
						if (err) {
							console.log(err);
							return false;
						}
						console.log(res);
					})
				">New</a></li>
				<li class="rule"></li>
				<li><label for="uploadSingle">Upload File</label></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.uploadUrl(
						window.prompt('Type image URL(URLs are case sensitive in github.io)', './img/1.JPG')
					)
				">Upload URL</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.uploadState(testImportState[0])
				">Upload State</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.uploadElement(
						document.getElementById(
							window.prompt('Type element ID', 'image-1')
						)
					)
				">Upload Element</a></li>
				<li class="rule"></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.draw({
						filename: 'original',
						dataType: 'url'
					}, function(err, res, result){
						console.log(err, result);
						canvaaas.download(res, result.filename);
					});
				">Save<br />(iOS not supported)</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.draw({
						filename: 'thumbnail',
						mimeType: 'image/png',
						dataType: 'url',
						width: 256, 
						height: 256, 
						quality: 0.5,
						backgroundColor: '#000000',
					}, function(err, res, result){
						console.log(err, result);
						canvaaas.download(res, result.filename);
					})
				">Save Thumbnail</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.drawTo({
						filename: 'original',
						dataType: 'url'
					}, 
					testCanvasState,
					testImportState,
					function(err, res, result){
						console.log(err, result);
						canvaaas.download(res, result.filename);
					})
				">Save from JSON<br />(iOS not supported)</a></li>
				<li><a href="javascript:void(0)" onclick="
					// new tab
					canvaaas.draw({
						filename: 'original',
						dataType: 'url'
					}, function(err, res){
						canvaaas.newTab(res);
					})
				">New Tab</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.drawTo({
						filename: 'original',
						dataType: 'url'
					}, 
					testCanvasState,
					testImportState,
					function(err, res, result){
						console.log(err, result);
						canvaaas.newTab(res);
					})
				">New Tab from JSON</a></li>
				<li class="rule"></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.export(function(err, res, result){
						if (err) {
							console.log(err);
							return false;
						}
						console.log('export callback', res, result);

						alert(JSON.stringify(res, null, 2));
					})
				">Export</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.import(JSON.stringify(testImportState), function(err, res){
						if (err) {
							console.log(err);
							return false;
						}
						console.log('import callback', res);
					})
				">Import</a></li>
				<li class="rule"></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.getConfigData(function(err, res){
						if (err) {
							alert(err);
							return false;
						}
						console.log(res);
						alert(JSON.stringify(res, null, 2));
					})
				">Get Config Data</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.getCanvasData(function(err, res){
						if (err) {
							alert(err);
							return false;
						}
						console.log(res);
						alert(JSON.stringify(res, null, 2));
					})
				">Get Canvas Data</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.findOne({
						id: canvaaas.this()
					}, function(err, res){
						if (err) {
							alert(err);
							return false;
						}
						console.log(res);
						alert(JSON.stringify(res, null, 2));
					})
				">Get Image Data</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.getUndoData(function(err, res){
						if (err) {
							alert(err);
							return false;
						}
						console.log(res);
						alert(JSON.stringify(res, null, 2));
					})
				">Get Undo Data</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.getRedoData(function(err, res){
						if (err) {
							alert(err);
							return false;
						}
						console.log(res);
						alert(JSON.stringify(res, null, 2));
					})
				">Get Redo Data</a></li>
				<li class="rule"></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.config(testConfig, function(err, res){
						if (err) {
							console.log(err);
							return false;
						}
						canvaaas.init(document.getElementById('myContainer'), function(err, res){
							if (err) {
								console.log(err);
								return false;
							}
						})
					})
				">Init</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.destroy(function(err, res){
						if (err) {
							console.log(err);
							return false;
						}
					})
				">Destroy</a></li>
			</ul>
		</div>
		<div class="header-tab">
			<a href="javascript:void(0)" class="header-subject">Edit</a>
			<ul class="header-list hidden">
				<li><a id="undo" href="javascript:void(0)" onclick="
					canvaaas.undo(function(err, res){
						if (err) {
							console.log(err);
							return false;
						}
						checkCaches();
					})
				">Undo</a></li>
				<li><a id="redo" href="javascript:void(0)" onclick="
					canvaaas.redo(function(err, res){
						if (err) {
							console.log(err);
							return false;
						}
						checkCaches();
					})
				">Redo</a></li>
				<li class="rule"></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.findOne({
						index: 2
					}, function(err, res){
						if (err) {
							alert(err);
							return false;
						}
						console.log(res);
						alert(JSON.stringify(res, null, 2));
					})
				">Find One {index: 2}</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.findMany({
						index: 2
					}, function(err, res){
						if (err) {
							alert(err);
							return false;
						}
						console.log(res);
						alert(JSON.stringify(res, null, 2));
					})
				">Find Many {index: 2}</a></li>
				<li class="rule"></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.updateOne({
						index: 2
					}, {
						x: 0,
						y: 0
					}, function(err, res){
						if (err) {
							alert(err);
							return false;
						}
						console.log(res);
						alert(JSON.stringify(res, null, 2));
					})
				">Update One {index: 2}</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.updateMany({
						index: 2
					}, {
						x: 0,
						y: 0
					}, function(err, res){
						if (err) {
							alert(err);
							return false;
						}
						console.log(res);
						alert(JSON.stringify(res, null, 2));
					})
				">Update Many {index: 2}</a></li>
				<li class="rule"></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.id(canvaaas.this(), window.prompt('Type new ID'))
				">Set ID</a></li>
				<li class="rule"></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.move(canvaaas.this(), 0, -10)
				">Move Top</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.move(canvaaas.this(), 0, 10)
				">Move Bottom</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.move(canvaaas.this(), -10, 0)
				">Move Left</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.move(canvaaas.this(), 10, 0)
				">Move Right</a></li>
				<li class="rule"></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.moveTo(canvaaas.this(), 'left', 'top')
				">Move Top-Left</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.moveTo(canvaaas.this(), 'center', 'top')
				">Move Top-Center</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.moveTo(canvaaas.this(), 'right', 'top')
				">Move Top-Right</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.moveTo(canvaaas.this(), 'left', 'middle')
				">Move Middle-Left</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.moveTo(canvaaas.this(), 'center', 'middle')
				">Move Middle-Center</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.moveTo(canvaaas.this(), 'right', 'middle')
				">Move Middle-Right</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.moveTo(canvaaas.this(), 'left', 'bottom')
				">Move Bottom-Left</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.moveTo(canvaaas.this(), 'center', 'bottom')
				">Move Bottom-Center</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.moveTo(canvaaas.this(), 'right', 'bottom')
				">Move Bottom-Right</a></li>
				<li class="rule"></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.zoom(canvaaas.this(), 0.1)
				">Zoom In</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.zoom(canvaaas.this(), -0.1)
				">Zoom Out</a></li>
				<li class="rule"></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.zoomTo(canvaaas.this(), 0.01)
				">Zoom 0.01</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.zoomTo(canvaaas.this(), 0.1)
				">Zoom 0.1</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.zoomTo(canvaaas.this(), 1)
				">Zoom 1</a></li>
				<li class="rule"></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.zoomTo(canvaaas.this(), 'cover')
				">Zoom Cover</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.zoomTo(canvaaas.this(), 'contain')
				">Zoom Contain</a></li>
				<li class="rule"></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.rotate(canvaaas.this(), -45)
				">Rotate Left</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.rotate(canvaaas.this(), 45)
				">Rotate Right</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.rotateTo(canvaaas.this(), 0)
				">Rotate Reset</a></li>
				<li class="rule"></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.flipX(canvaaas.this())
				">Flip Horizontally</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.flipY(canvaaas.this())
				">Flip Vertically</a></li>
				<li class="rule"></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.opacity(canvaaas.this(), window.prompt('0 ~ 1', '0.5'))
				">Opacity</a></li>
				<li class="rule"></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.indexTo(canvaaas.this(), window.prompt('Number', '5'))
				">Index To</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.index(canvaaas.this(), 1)
				">Index +1</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.index(canvaaas.this(), -1)
				">Index -1</a></li>
				<li class="rule"></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.focusIn(window.prompt('ID'))
				">Focus In</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.focusOut()
				">Focus Out</a></li>
				<li class="rule"></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.restrict(canvaaas.this())
				">Toggle Restrict</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.focusable(canvaaas.this())
				">Toggle Focusable</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.editable(canvaaas.this())
				">Toggle Editable</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.drawable(canvaaas.this())
				">Toggle Drawable</a></li>
				<li class="rule"></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.remove(canvaaas.this())
				">Remove</a></li>
				<li class="rule"></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.reset(canvaaas.this())
				">Reset</a></li>
			</ul>
		</div>
		<div class="header-tab">
			<a href="javascript:void(0)" class="header-subject">Canvas</a>
			<ul class="header-list hidden">
				<li><a href="javascript:void(0)" onclick="
					canvaaas.freeze()
				">Freeze</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.thaw()
				">Thaw</a></li>
				<li class="rule"></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.resize({
						width: window.prompt('Type width', '6'),
						height: window.prompt('Type height', '4'),
						unit: window.prompt('Type unit', 'in'),
						dpi: window.prompt('Type dpi', '300'),
					}, function(err, res){
						if (err) {
							console.log(err);
							return false;
						}
						writeCanvasData();
					})
				">Resize</a></li>
				<li class="rule"></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.background(window.prompt('e.g. #FFFFFF', '#000000'), function(err, res){
						if (err) {
							console.log(err);
							return false;
						}
						writeCanvasData();
					})
				">Background Color</a></li>
				<li class="rule"></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.active(function(err, res){
						if (err) {
							console.log(err);
							return false;
						}
						writeCanvasData();
					})
				">Toggle Editable</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.checker()
				">Toggle Checker</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.overlay()
				">Toggle Overlay</a></li>
			</ul>
		</div>
		<div class="header-tab">
			<a href="javascript:void(0)" class="header-subject">View</a>
			<ul class="header-list hidden">
				<li><a id="showCursor" href="javascript:void(0)">Show Cursor Data</a></li>
				<li><a id="showCanvas" href="javascript:void(0)">Show Canvas Data</a></li>
				<li><a id="showImage" href="javascript:void(0)">Show Image Data</a></li>
			</ul>
		</div>
	</div>

	<div id="myContainer"></div>

	<div id="myCanvas" class="hidden">
		<div id="myCanvas-filename"></div>
		<div id="myCanvas-state"></div>
		<div id="myCanvas-backgroundColor"></div>
		<span style="float: right; font-size: 0.8rem; margin-right: 0.1rem;">bg:</span>
		<div id="myCanvas-editabled"></div>
		<div style="clear: both;"></div>
	</div>

	<div id="myImage" class="">
		<div id="myImage-id"></div>
		<div id="myImage-state"></div>
		<div style="clear: both;"></div>
	</div>

	<div id="myCursor" class="hidden">
		<div id="myCursor-id"></div>
		<div id="myCursor-state"></div>
		<div style="clear: both;"></div>
	</div>

	<div style="display: none;">
		<img
			id="image-1"
			src="./img/1.JPG"
			data-id = "test-1"
	        data-src = "./img/1.JPG"
	        data-index = "1"
	        data-width = "7858.705673285891"
	        data-height = "5239.137115523928"
	        data-x = "2037.033467202142"
	        data-y = "1529.8313253012047"
	        data-rotate = "-338.99078178925924"
	        data-scaleX = "1"
	        data-scaleY = "-1"
	        data-opacity = "1"
	        data-restricted = "false"
	        data-focusabled = "true"
	        data-editabled = "true"
	        data-drawabled = "true">
		<img 
			id="image-2" 
			src="./img/1.jpeg" 
			data-state='{"id":"test-2","index":1,"width":7858.705673285891,"height":5239.137115523928,"x":2037.033467202142,"y":1529.8313253012047,"rotate":-338.99078178925924,"scaleX":1,"scaleY":-1,"opacity":1,"restricted":true,"focusabled":true,"editabled":true,"drawabled":true}'>
		<img
			id="image-3"
			src="./img/1.JPG"
	        data-width = "7858.705673285891">
		<img
			id="image-4"
			src="./img/1.JPG">
		<img 
			id="image-5" 
			src="./img/1.jpeg" 
			data-state='{"width":7858.705673285891}'>
	</div>

	<script>

		var buttons = {
			undo: document.getElementById("undo"),
			redo: document.getElementById("redo"),
		}

		var target = document.getElementById("myContainer");

		// 
		// 
		// MAIN START
		// 
		// 

		// #1 config
		canvaaas.config({
			hover: function(err, res){
				if (err) {
					console.log(err);
					return false;
				}

				writeCursor(res);

				// console.log("config.hover callback", res);
			},
			upload: function(err, res){
				if (err) {
					console.log(err);
					return false;
				}

				checkCaches();

				console.log("config.upload callback", res);
			},
			focus: function(err, res){
				if (err) {
					console.log(err);
					return false;
				}

				writeImageData(res);
				checkCaches();

				console.log("config.focus callback", res);
			},
			edit: function(err, res){
				if (err) {
					console.log(err);
					return false;
				}

				writeImageData(res);
				checkCaches();

				console.log("config.edit callback", res);
			},
		});

		// #1.1 canvas before init
		canvaaas.resize({
			width: 7858.705673285892,
			height: 5239.137115523928,
			unit: "px",
			dpi : 1
		});

		// #2 init
		canvaaas.init(target, function(err, res){
			if (err) {
				console.log(err);
				return false;
			}

			writeCanvasData();

			checkCaches();

			console.log("canvaaas.init callback", res);
		});

		// #2.1 canvas after init
		// canvaaas.resize({
		// 	width: 7858.705673285892,
		// 	height: 5239.137115523928,
		// 	unit: "px",
		//  	dpi : 1
		// });

		
		// #3 upload test
//		canvaaas.uploadUrl("./img/1.JPG", function(err, res){
//			if (err) {
//				console.log(err);
//				return false;
//			}
//			console.log(res);
//		});





		// 
		// 
		// MAIN END
		// 
		// 

		function writeCanvasData(){
			var state = canvaaas.getCanvasData();

			var sFilename = document.getElementById("myCanvas-filename");
			var sEditabled = document.getElementById("myCanvas-editabled");
			var sBackground = document.getElementById("myCanvas-backgroundColor");
			var sState = document.getElementById("myCanvas-state");

			sFilename.innerHTML = state.filename + "." + state.mimeType.split("/").pop();
			
			sState.innerHTML = "";
			sState.innerHTML += "w:" + Math.floor(state.width);
			sState.innerHTML += " h:" + Math.floor(state.height);

			sEditabled.innerHTML = state.editabled ? 
				"" : 
				"<span style='color: red;'>Uneditabled</span>";

			sBackground.style.backgroundColor = state.backgroundColor;
		}

		function writeImageData(state){
			var sId = document.getElementById("myImage-id");
			var sState = document.getElementById("myImage-state");

			if (!state) {
				sId.innerHTML = "";
				sState.innerHTML = "";
				return false;
			}

			sId.innerHTML = state.id;

			sState.innerHTML = "";
			sState.innerHTML += " index:" + state.index;
			sState.innerHTML += " x:" + Math.floor(state.x);
			sState.innerHTML += " y:" + Math.floor(state.y);
			sState.innerHTML += " w:" + Math.floor(state.width);
			sState.innerHTML += " h:" + Math.floor(state.height);
			sState.innerHTML += " deg:" + Math.floor(state.rotate);
			sState.innerHTML += " flipX:" + state.scaleY;
			sState.innerHTML += " flipY:" + state.scaleX;
			sState.innerHTML += " opacity " + state.opacity;
		}

		function writeCursor(res) {
			var sId = document.getElementById("myCursor-id");
			var sState = document.getElementById("myCursor-state");
			if (res.target) {
				sId.innerHTML = res.target;
			} else {
				sId.innerHTML = "";
			}

			sState.innerHTML = "";
			sState.innerHTML += "x:" + Math.floor(res.x);
			sState.innerHTML += " y:" + Math.floor(res.y);
		}

		function checkCaches(){
			if (canvaaas.getUndoData() < 1) {
				buttons.undo.style.pointerEvents = "none";
				buttons.undo.style.cursor = "default";
				buttons.undo.style.color = "#777";
			} else {
				buttons.undo.style.pointerEvents = "";
				buttons.undo.style.cursor = "";
				buttons.undo.style.color = "";
			}
			if (canvaaas.getRedoData() < 1) {
				buttons.redo.style.pointerEvents = "none";
				buttons.redo.style.cursor = "default";
				buttons.redo.style.color = "#777";
			} else {
				buttons.redo.style.pointerEvents = "";
				buttons.redo.style.cursor = "";
				buttons.redo.style.color = "";
			}
		}

		(function(){
			var sCursor = document.getElementById("showCursor");
			var sCanvas = document.getElementById("showCanvas");
			var sImage = document.getElementById("showImage");

			var aCursor = document.getElementById("myCursor");
			var aCanvas = document.getElementById("myCanvas");
			var aImage = document.getElementById("myImage");

			var opened = aImage;

			function evtHandle(e) {
				if (opened) {
					if (opened.isSameNode(aCursor)) {
						aCursor.classList.add("hidden");
					} else if (opened.isSameNode(aCanvas)) {
						aCanvas.classList.add("hidden");
					} else if (opened.isSameNode(aImage)) {
						aImage.classList.add("hidden");
					}
					opened = undefined;
				}

				if (e.target.isSameNode(sCursor)) {
					aCursor.classList.remove("hidden");
					opened = aCursor;
				} else if (e.target.isSameNode(sCanvas)) {
					aCanvas.classList.remove("hidden");
					opened = aCanvas;
				} else if (e.target.isSameNode(sImage)) {
					aImage.classList.remove("hidden");
					opened = aImage;
				}
			}

			sCursor.addEventListener("click", evtHandle, false);
			sCanvas.addEventListener("click", evtHandle, false);
			sImage.addEventListener("click", evtHandle, false);
		})();

		(function(){
			var header = document.getElementById("header");
			var tabs = header.querySelectorAll("a.header-subject");
			var opened;

			tabs.forEach(function(t){
				t.addEventListener("click", function(e){
					e.preventDefault();
					e.stopPropagation();

					var isThis = false;
					var list = e.target.parentNode.querySelector(".header-list");

					if (opened) {
						if (opened.isSameNode(list)) {
							isThis = true;
						}
						opened.classList.add("hidden");
						opened = undefined;
					}

					if (isThis === true) {
						return false;
					}

					if (list.classList.contains("hidden") === true) {
						list.classList.remove("hidden");
						opened = list;
					}
				});

				var btns = t.parentNode.querySelector(".header-list").querySelectorAll("li");
				btns.forEach(function(b){
					if (!b.classList.contains("rule")) {
						b.addEventListener("click", function(e){
							if (opened) {
								opened.classList.add("hidden");
								opened = undefined;
							}
						})
					}
				});
			});
		})();

		var testConfig = {
			hover: function(err, res){
				if (err) {
					console.log(err);
					return false;
				}

				writeCursor(res);

				// console.log("config.hover callback", res);
			},
			upload: function(err, res){
				if (err) {
					console.log(err);
					return false;
				}

				checkCaches();

				console.log("config.upload callback", res);
			},
			focus: function(err, res){
				if (err) {
					console.log(err);
					return false;
				}

				writeImageData(res);
				checkCaches();

				console.log("config.focus callback", res);
			},
			edit: function(err, res){
				if (err) {
					console.log(err);
					return false;
				}

				writeImageData(res);
				checkCaches();

				console.log("config.edit callback", res);
			},
		}
		
		var testCanvasState = {
			"filename": "untitled",
			"width": 7858.705673285892,
			"height": 5239.137115523928,
			"editabled": true,
			"mimeType": "image/png",
			"dataType": "file",
			"quality": 0.92,
			"aspectRatio": "3:2"
		}

		var testImportState = [{
	        "id": "1.JPG",
	        "index": 1,
	        "originalWidth": 3024,
	        "originalHeight": 4032,
	        "width": 5058.658727201191,
	        "height": 6744.878302934924,
	        "x": 5295.4455985412405,
	        "y": 1003.7599146564536,
	        "rotate": -46.416011804284835,
	        "scaleX": 1,
	        "scaleY": 1,
	        "opacity": 0.5,
	        "restricted": true,
	        "focusabled": true,
	        "editabled": true,
	        "drawabled": true,
	        "originalAspectRatio": "3:4",
	        "aspectRatio": "3:4",
	        "left": 2766.116234940645,
	        "top": -2368.6792368110086,
	        "src": "img/1.JPG"
	    }, {
	        "id": "1.jpeg",
	        "index": 2,
	        "originalWidth": 5472,
	        "originalHeight": 3648,
	        "width": 6516.947545957242,
	        "height": 4344.631697304831,
	        "x": 1696.5990752607859,
	        "y": 4235.377200867475,
	        "rotate": 22.791923828768304,
	        "scaleX": 1,
	        "scaleY": 1,
	        "opacity": 1,
	        "restricted": true,
	        "focusabled": true,
	        "editabled": true,
	        "drawabled": true,
	        "originalAspectRatio": "3:2",
	        "aspectRatio": "3:2",
	        "left": -1561.8746977178353,
	        "top": 2063.0613522150597,
	        "src": "img/1.jpeg"
	    }, {
	        "id": "1.png",
	        "index": 3,
	        "originalWidth": 800,
	        "originalHeight": 800,
	        "width": 3048.60471766451,
	        "height": 3048.60471766451,
	        "x": 6734.984207853423,
	        "y": 4059.107167074146,
	        "rotate": 0,
	        "scaleX": 1,
	        "scaleY": 1,
	        "opacity": 1,
	        "restricted": true,
	        "focusabled": true,
	        "editabled": true,
	        "drawabled": true,
	        "originalAspectRatio": "1:1",
	        "aspectRatio": "1:1",
	        "left": 5210.681849021168,
	        "top": 2534.804808241891,
	        "src": "img/1.png"
	    }];

	</script>
</body>
</html>