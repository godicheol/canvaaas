<!DOCTYPE html>
<html>
<head>
<title>canvaaas</title>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- ! -->
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel='stylesheet' href='./dist/canvaaas.css' />
<script src="./dist/canvaaas.js"></script>
<!-- ! -->

<style>
	html,
	body,
	div{
		margin: 0;
		padding: 0;
	}

	#myContainer{
		margin-top: 27px;
		padding: 24px;
		overflow: hidden;
		/*background-color: #000;*/
	}

	#myImage,
	#myCanvas{
		/*color: #FFF;*/
		/*background-color: #000;*/
		/*border-top: 1px solid black;*/
		font-size: 0.8rem;
		padding: 3px 24px;
	}

	#myCanvas.hidden,
	#myImage.hidden{
		display: none;
	}

	#myCanvas-filename{
		float: left;
	}
	#myCanvas-editabled{
		float: right;
		margin-right: 6px;
	}
	#myCanvas-backgroundColor{
		width: 1rem;
		height: 1rem;
		margin-right: 6px;
		outline: 1px solid black;
		float: right;
	}
	#myCanvas-state{
		float: right;
	}

	#myImage-id{
		float: left;
	}
	#myImage-state{
		float: right;
	}

	input[type='file']{
		display: none;
	}
	label,
	button{
		font-family: arial;
		padding: 3px 6px;
		font-size: 14px;
		border: 1px solid #777;
		border-radius: 2px;
		background-color: #e7e7e7;
		cursor: pointer;
	}
	label:hover,
	button:hover{
		background-color: #c7c7c7;
	}
	label:active,
	button:active{
		background-color: #e7e7e7;
	}

	.header{
		position: absolute;
		top: 0;
		left: 0;
		right: 0;
		font-size: 0;
		font-family: sans-serif;
		/*border-bottom: 1px solid black;*/
	}
	.header-hidden{
		display: none;
	}
	.header-tab{
		position: relative;
		display: inline-block;
		vertical-align: top;
		width: auto;
	}
	.header-subject{
		display: block;
		color: inherit;
		text-decoration: none;
		font-size: 0.8rem;
		font-weight: 700;
		padding: 6px 12px;
		cursor: default;
	}
	.header-tab:hover .header-subject{
		background-color: #e7e7e7;
	}
	.header-list{
		position: absolute;
		list-style: none;
		min-width: 150px;
		margin: 0 6px;
		padding: 6px 6px;
		background-color: #171717;
		max-height: 500px;
		z-index: 999;
		overflow-y: auto;
	}
	.header-list.hidden{
		display: none;
	}
	.header-list a,
	.header-list label{
		display: block;
		color: #e7e7e7;
		text-decoration: none;
		padding: 6px 6px;
		margin: 0px;
		cursor: default;
		background-color: rgba(0,0,0,0);
		border: 0;
		border-radius: 0;
		font-size: 0.8rem;
	}
	.header-list a:hover,
	.header-list label:hover{
		background-color: #373737;
	}
	.header-list li.rule{
		margin: 6px;
		border-top: 1px solid #575757;
		color: #e7e7e7;
	}
</style>
</head>
<body style="padding-top: 0; padding-bottom: 0;">

	<div id="header" class="header">
		<div class="header-hidden">
			<input id="uploadSingle" type="file" onchange="canvaaas.uploadFile(this.files)" accept="image/*">
		</div>
		<div class="header-tab">
			<a href="javascript:void(0)" class="header-subject">Canvaaas.js</a>
			<ul class="header-list hidden">
				<li><a href="javascript:void(0)" onclick="alert('Created by eeecheol@gmail.com')">About Canvaaas</a></li>
			</ul>
		</div>
		<div class="header-tab">
			<a href="javascript:void(0)" class="header-subject">File</a>
			<ul class="header-list hidden">
				<li><a href="javascript:void(0)" onclick="
					canvaaas.new({
						width: window.prompt('Type Width', '1800'),
						height: window.prompt('Type Height', '1200'),
					}, function(err, res){
						if (err) {
							console.log(err);
							return false;
						}
						console.log(res);
					})
				">New</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.close(function(err, res){
						if (err) {
							console.log(err);
							return false;
						}
						console.log(res);
					})
				">Close</a></li>
				<li class="rule"></li>
				<li><label for="uploadSingle">Upload from File</label></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.uploadUrl(
						window.prompt('Type image URL(URLs are case sensitive in github.io)', './img/1.png')
					)
				">Upload from URL</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.uploadState(testImportStates[0])
				">Upload from State</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.uploadElement(
						document.getElementById(
							window.prompt('Type Element ID (e.g. image-2)', 'image-1')
						)
					)
				">Upload from Element</a></li>
				<li class="rule"></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.draw({
						filename: 'original',
						dataType: 'url'
					}, function(err, res, result){
						if (err) {
							console.log(err);
							return false;
						}
						myDownload(res, result.filename);
					});
				">Save</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.draw({
						filename: 'thumbnail',
						mimeType: 'image/png',
						dataType: 'url',
						width: 256,
						height: 256,
						quality: 0.5,
						background: '#000000',
					}, function(err, res, result){
						if (err) {
							console.log(err);
							return false;
						}
						myDownload(res, result.filename);
					});
				">Save To<br />256 x 256 px</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.draw({
						filename: 'large',
						mimeType: 'image/png',
						dataType: 'url',
						width: 5120,
						height: 5120,
						quality: 0.5,
						background: '#FFFFFF',
					}, function(err, res, result){
						if (err) {
							console.log(err);
							return false;
						}
						myDownload(res, result.filename);
					});
				">Save To<br />5120 x 5120 px</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.drawTo({
				    filename: 'TEST',
				    quality: 0.92,
				    mimeType: 'image/png',
				    dataType: 'url',
				    background: '#FFFFFF',
				    width: 1800,
				    height: 1200,
						drawWidth: 3600,
						drawHeight: 3600
					},
					testImportStates,
					function(err, res, result){
						if (err) {
							console.log(err);
							return false;
						}
						myDownload(res, result.filename); // iOS not supported
					})
				">Save from JSON<br />(iOS chrome not supported)</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.draw({
						filename: 'original',
						dataType: 'url'
					}, function(err, res){
						if (err) {
							console.log(err);
							return false;
						}
						newTab(res);
					})
				">New Tab<br />(iOS safari not supported)</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.drawTo({
				    filename: 'TEST',
				    quality: 0.92,
				    mimeType: 'image/png',
				    dataType: 'url',
				    background: '#FFFFFF',
				    width: 1800,
				    height: 1200,
						drawWidth: 3600,
						drawHeight: 3600
					},
					testImportStates,
					function(err, res, result){
						if (err) {
							console.log(err);
							return false;
						}
						newTab(res);
					})
				">New Tab from JSON<br />(iOS safari not supported)</a></li>
				<li class="rule"></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.export(function(err, res){
						if (err) {
							console.log(err);
							return false;
						}
						console.log('export callback', res);
						alert(JSON.stringify(res, null, 2));
					})
				">Export</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.import(JSON.stringify(testImportStates), function(err, res){
						if (err) {
							console.log(err);
							return false;
						}
						console.log('import callback', res);
					})
				">Import</a></li>
				<li class="rule"></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.getConfig(function(err, res){
						if (err) {
							alert(err);
							return false;
						}
						console.log('getConfig callback', res);
						alert(JSON.stringify(res, null, 2));
					})
				">Get Config Data</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.getCanvas(function(err, res){
						if (err) {
							alert(err);
							return false;
						}
						console.log('getCanvas callback', res);
						alert(JSON.stringify(res, null, 2));
					})
				">Get Canvas Data</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.getImages(function(err, res){
						if (err) {
							alert(err);
							return false;
						}
						console.log('getImages callback', res);
						alert(JSON.stringify(res, null, 2));
					})
				">Get Image Data</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.getUndo(function(err, res){
						if (err) {
							alert(err);
							return false;
						}
						console.log('getUndo callback', res);
						alert(JSON.stringify(res, null, 2));
					})
				">Get Number of Undo Caches</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.getRedo(function(err, res){
						if (err) {
							alert(err);
							return false;
						}
						console.log('getRedo callback', res);
						alert(JSON.stringify(res, null, 2));
					})
				">Get Number of Redo Caches</a></li>
				<li class="rule"></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.init(document.getElementById('myContainer'), function(err, res){
						if (err) {
							console.log(err);
							return false;
						}
						canvaaas.config(testConfig, function(err, res){
							if (err) {
								console.log(err);
								return false;
							}
						})
					})
				">Init</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.destroy(function(err, res){
						if (err) {
							console.log(err);
							return false;
						}
					})
				">Destroy</a></li>
			</ul>
		</div>
		<div class="header-tab">
			<a href="javascript:void(0)" class="header-subject">Edit</a>
			<ul class="header-list hidden">
				<li><a id="undo" href="javascript:void(0)" onclick="
					canvaaas.undo(function(err, res){
						if (err) {
							console.log(err);
							return false;
						}
						checkCaches();
					})
				">Undo</a></li>
				<li><a id="redo" href="javascript:void(0)" onclick="
					canvaaas.redo(function(err, res){
						if (err) {
							console.log(err);
							return false;
						}
						checkCaches();
					})
				">Redo</a></li>
				<li class="rule"></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.findOne({
						index: 2
					}, function(err, res){
						if (err) {
							alert(err);
							return false;
						}
						console.log(res);
						alert(JSON.stringify(res, null, 2));
					})
				">Find One {index: 2}</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.findMany({
						index: 2
					}, function(err, res){
						if (err) {
							alert(err);
							return false;
						}
						console.log(res);
						alert(JSON.stringify(res, null, 2));
					})
				">Find Many {index: 2}</a></li>
				<li class="rule"></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.updateOne({
						index: 2
					}, {
						x: 0,
						y: 0
					}, function(err, res){
						if (err) {
							alert(err);
							return false;
						}
						console.log(res);
						alert(JSON.stringify(res, null, 2));
					})
				">Update One {index: 2}</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.updateMany({
						index: 2
					}, {
						x: 0,
						y: 0
					}, function(err, res){
						if (err) {
							alert(err);
							return false;
						}
						console.log(res);
						alert(JSON.stringify(res, null, 2));
					})
				">Update Many {index: 2}</a></li>
				<li class="rule"></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.id(canvaaas.this(), window.prompt('Type new ID'))
				">Set ID</a></li>
				<li class="rule"></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.move(canvaaas.this(), 0, -10)
				">Move Top</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.move(canvaaas.this(), 0, 10)
				">Move Bottom</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.move(canvaaas.this(), -10, 0)
				">Move Left</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.move(canvaaas.this(), 10, 0)
				">Move Right</a></li>
				<li class="rule"></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.moveTo(canvaaas.this(), 'left', 'top')
				">Move Top-Left</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.moveTo(canvaaas.this(), 'center', 'top')
				">Move Top-Center</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.moveTo(canvaaas.this(), 'right', 'top')
				">Move Top-Right</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.moveTo(canvaaas.this(), 'left', 'middle')
				">Move Middle-Left</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.moveTo(canvaaas.this(), 'center', 'middle')
				">Move Middle-Center</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.moveTo(canvaaas.this(), 'right', 'middle')
				">Move Middle-Right</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.moveTo(canvaaas.this(), 'left', 'bottom')
				">Move Bottom-Left</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.moveTo(canvaaas.this(), 'center', 'bottom')
				">Move Bottom-Center</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.moveTo(canvaaas.this(), 'right', 'bottom')
				">Move Bottom-Right</a></li>
				<li class="rule"></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.zoom(canvaaas.this(), 0.1)
				">Zoom In</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.zoom(canvaaas.this(), -0.1)
				">Zoom Out</a></li>
				<li class="rule"></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.zoomTo(canvaaas.this(), 0.01)
				">Zoom 0.01</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.zoomTo(canvaaas.this(), 0.1)
				">Zoom 0.1</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.zoomTo(canvaaas.this(), 1)
				">Zoom 1</a></li>
				<li class="rule"></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.zoomTo(canvaaas.this(), 'cover')
				">Zoom Cover</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.zoomTo(canvaaas.this(), 'contain')
				">Zoom Contain</a></li>
				<li class="rule"></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.rotate(canvaaas.this(), -45)
				">Rotate Left</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.rotate(canvaaas.this(), 45)
				">Rotate Right</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.rotateTo(canvaaas.this(), 0)
				">Rotate Reset</a></li>
				<li class="rule"></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.flipY(canvaaas.this())
				">Flip Horizontally</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.flipX(canvaaas.this())
				">Flip Vertically</a></li>
				<li class="rule"></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.opacity(canvaaas.this(), window.prompt('0 ~ 1', '0.5'))
				">Opacity</a></li>
				<li class="rule"></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.indexTo(canvaaas.this(), window.prompt('Number', '5'))
				">Index To</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.index(canvaaas.this(), 1)
				">Index +1</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.index(canvaaas.this(), -1)
				">Index -1</a></li>
				<li class="rule"></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.focusIn(window.prompt('ID'))
				">Focus In</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.focusOut()
				">Focus Out</a></li>
				<li class="rule"></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.restrict(canvaaas.this(), true)
				">Restrict</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.restrict(canvaaas.this(), false)
				">Unrestrict</a></li>
				<li class="rule"></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.focusable(canvaaas.this(), true)
				">Focusable</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.focusable(canvaaas.this(), false)
				">Unfocusable</a></li>
				<li class="rule"></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.editable(canvaaas.this(), true)
				">Editable</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.editable(canvaaas.this(), false)
				">Uneditable</a></li>
				<li class="rule"></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.drawable(canvaaas.this(), true)
				">Drawable</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.drawable(canvaaas.this(), false)
				">Undrawable</a></li>
				<li class="rule"></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.reset(canvaaas.this())
				">Reset</a></li>
				<li class="rule"></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.remove(canvaaas.this())
				">Remove</a></li>
			</ul>
		</div>
		<div class="header-tab">
			<a href="javascript:void(0)" class="header-subject">Canvas</a>
			<ul class="header-list hidden">
				<li><a href="javascript:void(0)" onclick="
					canvaaas.resize({
						width: window.prompt('Type width', '1800'),
						height: window.prompt('Type height', '1200'),
					}, function(err, res){
						if (err) {
							console.log(err);
							return false;
						}
						writeCanvasData();
					})
				">Resize</a></li>
				<li class="rule"></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.editableAll(true)
				">Editabled</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.editableAll(false)
				">Uneditabled</a></li>
				<li class="rule"></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.focusableAll(true)
				">Set Focusable</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.focusableAll(false)
				">Unset Focusabled</a></li>
				<li class="rule"></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.drawableAll(true)
				">Show Drawables</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.drawableAll(false)
				">Hide Drawables</a></li>
				<li class="rule"></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.background(window.prompt('e.g. #FFFFFF, alpha', '#000000'), function(err, res){
						if (err) {
							console.log(err);
							return false;
						}
						writeCanvasData();
					})
				">Set Background</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.background('alpha')
				">Unset Background</a></li>
				<li class="rule"></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.checker(true)
				">Show Checker</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.checker(false)
				">Hide Checker</a></li>
				<li class="rule"></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.overlay(true)
				">Show Overlay</a></li>
				<li><a href="javascript:void(0)" onclick="
					canvaaas.overlay(false)
				">Hide Overlay</a></li>
			</ul>
		</div>
		<div class="header-tab">
			<a href="javascript:void(0)" class="header-subject">View</a>
			<ul class="header-list hidden">
				<li><a id="showCanvas" href="javascript:void(0)">Show Canvas Data</a></li>
				<li><a id="showImage" href="javascript:void(0)">Show Image Data</a></li>
			</ul>
		</div>
	</div>

	<div id="myContainer"></div>

	<div id="myCanvas" class="hidden">
		<div id="myCanvas-filename"></div>
		<div id="myCanvas-state"></div>
		<div id="myCanvas-backgroundColor"></div>
		<span style="float: right; font-size: 0.8rem; margin-right: 0.1rem;">bg:</span>
		<div id="myCanvas-editabled"></div>
		<div style="clear: both;"></div>
	</div>

	<div id="myImage" class="">
		<div id="myImage-id"></div>
		<div id="myImage-state"></div>
		<div style="clear: both;"></div>
	</div>

	<div style="display: none;">
		<!-- IMG with dataset -->
		<img
			id="image-1"
			src="./img/1.png"
			data-id = "1"
      data-src = "./img/1.png"
      data-index = "1"
      data-width = "600"
      data-height = "600"
      data-x = "399.07235621521335"
      data-y = "808.7198515769946"
      data-rotate = "17.46323891797897"
      data-scaleX = "1"
      data-scaleY = "1"
      data-opacity = "1"
      data-restricted = "false"
      data-focusabled = "true"
      data-editabled = "true"
      data-drawabled = "true">

		<!-- IMG with data-state JSON.stringify(state) -->
		<img
			id="image-2"
			src="./img/2.jpg"
			data-state='{
	        "id": "2",
	        "type": "url",
	        "index": 2,
	        "originalWidth": 1350,
	        "originalHeight": 1800,
	        "width": 594.2754728305664,
	        "height": 792.367297107422,
	        "x": 1629.1280148423007,
	        "y": 366.2337662337663,
	        "rotate": 383.231324008005,
	        "scaleX": 1,
	        "scaleY": -1,
	        "opacity": 1,
	        "restricted": false,
	        "focusabled": true,
	        "editabled": true,
	        "drawabled": true,
	        "originalAspectRatio": "3:4",
	        "aspectRatio": "3:4",
	        "left": 1331.9902784270175,
	        "top": -29.94988231994472
	    }'>

		<img
			id="image-3"
			data-src="./img/3.jpeg"
			data-width = "948.4312600294483"
			data-height = "632.2875066862982"
			data-x = "151.39146567717992"
	    data-y = "291.0946196660483">

	</div>

	<script>
		var target = document.getElementById("myContainer");

		//
		//
		// MAIN START
		//
		//

		// #1 init
		canvaaas.init(target, function(err, res){
			if (err) {
				console.log(err);
				return false;
			}

			checkCaches();

			console.log("canvaaas.init() callback", res);
		});

		// #2 config
		canvaaas.config({
			canvas: function(err, res){
				if (err) {
					console.log(err);
					return false;
				}

				writeCanvasData();
				checkCaches();

				console.log("config.canvas callback", res);
			},
			upload: function(err, res){
				if (err) {
					console.log(err);
					return false;
				}

				writeCanvasData();
				checkCaches();

				console.log("config.upload callback", res);
			},
			focus: function(err, res){
				if (err) {
					console.log(err);
					return false;
				}

				writeImageData(res);
				checkCaches();

				console.log("config.focus callback", res);
			},
			edit: function(err, res){
				if (err) {
					console.log(err);
					return false;
				}

				writeImageData(res);
				checkCaches();

				console.log("config.edit callback", res);
			},
			remove: function(err, res){
				if (err) {
					console.log(err);
					return false;
				}

				checkCaches();

				console.log("config.remove callback", res);
			},
		}, function(err, res){
			if (err) {
				console.log(err);
				return false;
			}
		});

		// #3 create canvas
		canvaaas.new({
			width: 1800, // number, px
			height: 1200, // number, px
			filename: "TEST",
			overlay: true,
			checker: true
		}, function(err, res){
			if (err) {
				console.log(err);
				return false;
			}
			console.log("canvaaas.new() callback",res);
			writeCanvasData();
		});

		// #4 upload test
		// canvaaas.uploadUrl("./img/1.png", function(err, res){
		// 	if (err) {
		// 		console.log(err);
		// 		return false;
		// 	}
		// 	console.log(res);
		// });

		setTimeout(function(){



			// #4 upload test
			// canvaaas.uploadState(testImportStates[0], function(err, res){
			// 	if (err) {
			// 		console.log(err);
			// 		return false;
			// 	}
			// 	console.log(res);
			// });


			// #4 upload test
			// canvaaas.uploadState(testImportStates2, function(err, res){
			// 	if (err) {
			// 		console.log(err);
			// 		return false;
			// 	}
			// 	console.log(res);
			// });



		}, 200);





		//
		//
		// MAIN END
		//
		//



		// example
		// iOS chrome not supported (only large file?)
		function myDownload(myData, filename){
			var myLink = document.createElement('a');
			myLink.setAttribute('href', myData);
			myLink.setAttribute('download', filename);
			myLink.style.display = 'none';
			document.body.appendChild(myLink);
			myLink.click();
			document.body.removeChild(myLink);
			window.URL.revokeObjectURL(myData);
		}

		// example
		// iOS safari not supported
		function newTab(myData){
			var image = new Image();
			image.src = myData;
			image.style.position = 'absolute';
			image.style.top = '50%';
			image.style.left = '50%';
			image.style.transform = 'translate(-50%, -50%)';
			image.style.width = '100%';
			image.style.height = 'auto';

			var myNewTab = window.open('');
			myNewTab.document.write(image.outerHTML);
			myNewTab.document.body.style.backgroundColor = '#000000';
			myNewTab.document.body.style.padding = '24px';
			myNewTab.document.body.style.position = 'relative';

			window.URL.revokeObjectURL(myData);
		}

		function writeCanvasData(){
			var state = canvaaas.getCanvas();

			var sFilename = document.getElementById("myCanvas-filename");
			var sEditabled = document.getElementById("myCanvas-editabled");
			var sBackground = document.getElementById("myCanvas-backgroundColor");
			var sState = document.getElementById("myCanvas-state");

			sFilename.innerHTML = state.filename + "." + state.mimeType.split("/").pop();

			sState.innerHTML = "";
			sState.innerHTML += "w:" + Math.floor(state.width);
			sState.innerHTML += " h:" + Math.floor(state.height);

			sEditabled.innerHTML = state.editabled ?
				"" : "<span style='color: red;'>Uneditabled</span>";

			sBackground.style.backgroundColor = state.background;
		}

		function writeImageData(state){
			var sId = document.getElementById("myImage-id");
			var sState = document.getElementById("myImage-state");

			if (!state) {
				sId.innerHTML = "";
				sState.innerHTML = "";
				return false;
			}

			sId.innerHTML = state.id;

			sState.innerHTML = "";
			sState.innerHTML += " index:" + state.index;
			sState.innerHTML += " x:" + Math.floor(state.x);
			sState.innerHTML += " y:" + Math.floor(state.y);
			sState.innerHTML += " w:" + Math.floor(state.width);
			sState.innerHTML += " h:" + Math.floor(state.height);
			sState.innerHTML += " deg:" + Math.floor(state.rotate);
			sState.innerHTML += " flipX:" + state.scaleY;
			sState.innerHTML += " flipY:" + state.scaleX;
			sState.innerHTML += " opacity " + state.opacity;
		}

		function checkCaches(){
			var undo = document.getElementById("undo");
			var redo = document.getElementById("redo");
			if (canvaaas.getUndo() < 1) {
				undo.style.pointerEvents = "none";
				undo.style.cursor = "default";
				undo.style.color = "#777";
			} else {
				undo.style.pointerEvents = "";
				undo.style.cursor = "";
				undo.style.color = "";
			}
			if (canvaaas.getRedo() < 1) {
				redo.style.pointerEvents = "none";
				redo.style.cursor = "default";
				redo.style.color = "#777";
			} else {
				redo.style.pointerEvents = "";
				redo.style.cursor = "";
				redo.style.color = "";
			}
		}

		(function(){
			var sCanvas = document.getElementById("showCanvas");
			var sImage = document.getElementById("showImage");

			var aCanvas = document.getElementById("myCanvas");
			var aImage = document.getElementById("myImage");

			var opened = aImage;

			function evtHandle(e) {
				if (opened) {
					if (opened.isSameNode(aCanvas)) {
						aCanvas.classList.add("hidden");
					} else if (opened.isSameNode(aImage)) {
						aImage.classList.add("hidden");
					}
					opened = undefined;
				}

				if (e.target.isSameNode(sCanvas)) {
					aCanvas.classList.remove("hidden");
					opened = aCanvas;
				} else if (e.target.isSameNode(sImage)) {
					aImage.classList.remove("hidden");
					opened = aImage;
				}
			}

			sCanvas.addEventListener("click", evtHandle, false);
			sImage.addEventListener("click", evtHandle, false);
		})();

		(function(){
			var header = document.getElementById("header");
			var tabs = header.querySelectorAll("a.header-subject");
			var opened;

			tabs.forEach(function(t){
				t.addEventListener("click", function(e){
					e.preventDefault();
					e.stopPropagation();

					var isThis = false;
					var list = e.target.parentNode.querySelector(".header-list");

					if (opened) {
						if (opened.isSameNode(list)) {
							isThis = true;
						}
						opened.classList.add("hidden");
						opened = undefined;
					}

					if (isThis === true) {
						return false;
					}

					if (list.classList.contains("hidden") === true) {
						list.classList.remove("hidden");
						opened = list;
					}
				});

				var btns = t.parentNode.querySelector(".header-list").querySelectorAll("li");
				btns.forEach(function(b){
					if (!b.classList.contains("rule")) {
						b.addEventListener("click", function(e){
							if (opened) {
								opened.classList.add("hidden");
								opened = undefined;
							}
						})
					}
				});
			});
		})();

		var defaultConfig = {
			allowedExtensions: [
				"jpg",
				"jpeg",
				"png",
				"gif",
				"svg",
				"svg+xml",
				"tiff",
				"tif",
				"webp",
			], // array
			cacheLevels: 999, // number
			containerAspectRatio: 1 / 1, // number, width / height
			maxContainerWidth: 1, // number, 0 ~ 1 scale in viewport(device screen)
			maxContainerHeight: 0.7, // number, 0 ~ 1 scale in viewport(device screen)
			maxDrawWidth: 4096 * 4, // number, iOS always has been adjusted 4096px
			maxDrawHeight: 4096 * 4, // number, iOS always has been adjusted 4096px
			renderScale: 0.5, // number, 0 ~ 1 scale in canvas
			restrictAfterRender: false, // boolean
			restrictMove: false, // boolean
			restrictRotate: true, // boolean
			restrictResize: true, // boolean
			restrictFlip: false, // boolean
			restrictRotateAngleUnit: 45, // number, 1 ~ 360
			restrictFlipAngleUnit: 180, // number, 1 ~ 180
			upload: undefined, // callback function
			canvas: undefined, // callback function
			focus: undefined, // callback function
			edit: undefined, // callback function
			remove: undefined, // callback function
		}

		var testConfig = {
			canvas: function(err, res){
				if (err) {
					console.log(err);
					return false;
				}

				writeCanvasData();
				checkCaches();

				console.log("config.canvas callback", res);
			},
			upload: function(err, res){
				if (err) {
					console.log(err);
					return false;
				}

				writeCanvasData();
				checkCaches();

				console.log("config.upload callback", res);
			},
			focus: function(err, res){
				if (err) {
					console.log(err);
					return false;
				}

				writeImageData(res);
				checkCaches();

				console.log("config.focus callback", res);
			},
			edit: function(err, res){
				if (err) {
					console.log(err);
					return false;
				}

				writeImageData(res);
				checkCaches();

				console.log("config.edit callback", res);
			},
			remove: function(err, res){
				if (err) {
					console.log(err);
					return false;
				}

				checkCaches();

				console.log("config.remove callback", res);
			},
		}

		var testCanvasState = {
		    "filename": "TEST",
		    "quality": 0.92,
		    "mimeType": "image/png",
		    "dataType": "url",
		    "editabled": true,
		    "focusabled": true,
		    "drawabled": true,
		    "background": "#FFFFFF",
		    "overlay": true,
		    "checker": true,
		    "width": 1800,
		    "height": 1200,
		    "aspectRatio": "3:2"
		}

		var testImportStates = [{
        "id": "TEST_PNG",
        "type": "url",
        "src": "./img/1.png",
        "index": 1,
        "originalWidth": 800, // no use
        "originalHeight": 800, // no use
        "width": 600.0000000000001,
        "height": 600.0000000000001,
        "x": 399.07235621521335,
        "y": 808.7198515769946,
        "rotate": 17.46323891797897,
        "scaleX": 1,
        "scaleY": 1,
        "opacity": 1,
        "restricted": false,
        "focusabled": true,
        "editabled": true,
        "drawabled": true,
        "originalAspectRatio": "1:1",
        "aspectRatio": "1:1",
        "left": 99.07235621521329, // no use
        "top": 508.7198515769946 // no use
    }, {
        "id": "TEST_JPG",
        "type": "url",
        "src": "./img/2.jpg",
        "index": 2,
        "originalWidth": 1350, // no use
        "originalHeight": 1800, // no use
        "width": 594.2754728305664,
        "height": 792.367297107422,
        "x": 1629.1280148423007,
        "y": 366.2337662337663,
        "rotate": 383.231324008005,
        "scaleX": 1,
        "scaleY": -1,
        "opacity": 1,
        "restricted": false,
        "focusabled": true,
        "editabled": true,
        "drawabled": true,
        "originalAspectRatio": "3:4",
        "aspectRatio": "3:4",
        "left": 1331.9902784270175, // no use
        "top": -29.94988231994472 // no use
    }, {
        "id": "TEST_JPEG",
        "type": "url",
        "src": "./img/3.jpeg",
        "index": 3,
        "originalWidth": 1800, // no use
        "originalHeight": 1200, // no use
        "width": 948.4312600294483,
        "height": 632.2875066862982,
        "x": 151.39146567717992,
        "y": 291.0946196660483,
        "rotate": 334.3516430373584,
        "scaleX": -1,
        "scaleY": -1,
        "opacity": 1,
        "restricted": false,
        "focusabled": true,
        "editabled": true,
        "drawabled": true,
        "originalAspectRatio": "3:2",
        "aspectRatio": "3:2",
        "left": -322.8241643375442, // no use
        "top": -25.049133677100826 // no use
    }];

			var testImportStates2 = JSON.stringify({
	        "id": "UPLOADED_FROM_STATE",
	        "type": "url",
	        "src": "./img/1.png",
	        "index": 1,
	        "originalWidth": 800, // no use
	        "originalHeight": 800, // no use
	        "width": 600.0000000000001,
	        "height": 600.0000000000001,
	        "x": 399.07235621521335,
	        "y": 808.7198515769946,
	        "rotate": 17.46323891797897,
	        "scaleX": 1,
	        "scaleY": 1,
	        "opacity": 1,
	        "restricted": false,
	        "focusabled": true,
	        "editabled": true,
	        "drawabled": true,
	        "originalAspectRatio": "1:1",
	        "aspectRatio": "1:1",
	        "left": 99.07235621521329, // no use
	        "top": 508.7198515769946 // no use
	    });

	</script>
</body>
</html>
