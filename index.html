<!DOCTYPE html>
<html>

<head>
	<title>canvaaas.js</title>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
	<!-- ! -->
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel='stylesheet' href='./dist/canvaaas.css' />
	<script src="./dist/canvaaas.js"></script>
	<!-- ! -->

	<style>
		@font-face {
			font-family: 'Material Icons';
			font-style: normal;
			font-weight: 400;
			src: url(https://example.com/MaterialIcons-Regular.eot); /* For IE6-8 */
			src: local('Material Icons'),
			local('MaterialIcons-Regular'),
			url(https://example.com/MaterialIcons-Regular.woff2) format('woff2'),
			url(https://example.com/MaterialIcons-Regular.woff) format('woff'),
			url(https://example.com/MaterialIcons-Regular.ttf) format('truetype');
		}

		.material-icons {
			font-family: 'Material Icons';
			font-weight: normal;
			font-style: normal;
			font-size: 24px;  /* Preferred icon size */
			display: inline-block;
			line-height: 1;
			text-transform: none;
			letter-spacing: normal;
			word-wrap: normal;
			white-space: nowrap;
			direction: ltr;

			/* Support for all WebKit browsers. */
			-webkit-font-smoothing: antialiased;
			/* Support for Safari and Chrome. */
			text-rendering: optimizeLegibility;

			/* Support for Firefox. */
			-moz-osx-font-smoothing: grayscale;

			/* Support for IE. */
			font-feature-settings: 'liga';
		}

		/* Rules for sizing the icon. */
		.material-icons.md-18 { font-size: 18px; }
		.material-icons.md-24 { font-size: 24px; }
		.material-icons.md-36 { font-size: 36px; }
		.material-icons.md-48 { font-size: 48px; }

		/* Rules for using icons as black on a light background. */
		.material-icons.md-dark { color: rgba(0, 0, 0, 0.54); }
		.material-icons.md-dark.md-inactive { color: rgba(0, 0, 0, 0.26); }

		/* Rules for using icons as white on a dark background. */
		.material-icons.md-light { color: rgba(255, 255, 255, 1); }
		.material-icons.md-light.md-inactive { color: rgba(255, 255, 255, 0.3); }

		html, body, div {
			margin: 0;
			padding: 0;
			font-family: Arial, Helvetica, sans-serif;
		}
		html, body{
			position: relative;
			max-width: 100%;
			height: 100%;
			/* overflow: hidden; */
		}

		/* container */
		#target{
			overflow: hidden;
			margin: 0 auto;
			padding: 36px;
			box-sizing: border-box;
			width: 100%;
			height: 500px;
		}

		/*  */
		#myHelp{
			font-size: 0.8rem;
			text-align: center;
		}
		#myDebug{
			text-align: center;
		}

		/* header */
		.header{
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 24px;
			font-size: 0;
			color: #FFFFFF;
			background-color: rgba(0, 0, 0, 0.9);
			z-index: 1000;
		}
		.header a,
		.header input,
		.header button,
		.header label{
			color: inherit;
		}
		.header a.disabled,
		.header input.disable,
		.header button.disable,
		.header label.disable{
			pointer-events: none;
			color: #777777;
			cursor: default;
		}
		.header a.disabled:hover,
		.header input.disable:hover,
		.header button.disable:hover,
		.header label.disable:hover{
			text-decoration: none;
		}
		.header .tab{
			position: relative;
			display: inline-block;
			max-width: 16.6666%;
			width: 128px;
			height: 24px;
			text-align: center;
		}
		.header .title{
			font-size: 0.8rem;
			height: 24px;
		}
		.header .title:hover{
			background-color: #474747;
			cursor: pointer;
		}
		.header .title span{
			line-height: 24px;
		}
		.header .list{
			position: absolute;
			top: calc(100% + 5px);
			left: 5px;
			width: 192px;
			max-height: 524px;
			overflow-y: scroll;
			padding: 3px 9px;
			text-align: initial;
			background-color: rgba(0, 0, 0, 0.7);
		}
		.header .tab:nth-last-child(2) .list{
			left: auto;
			right: 5px;
		}
		.header .tab:nth-last-child(1) .list{
			left: auto;
			right: 5px;
		}
		.header .list a,
		.header .list label{
			display: block;
			width: 100%;
			font-size: inherit;
			font-family: inherit;
			text-decoration: none;
			cursor: pointer;
			padding: 6px 3px;
		}
		.header .list a:hover,
		.header .list label:hover{
			text-decoration: underline;
		}
		.header .row{
			font-size: 0.8rem;
			/* padding: 6px 3px; */
		}
		.header .row.rule{
			border-bottom: 1px solid #777777;
			padding-bottom: 3px;
			margin-bottom: 3px;
		}

		/* footer */
		.footer{
			position: fixed;
			bottom: 0;
			left: 0;
			width: 100%;
			height: auto;
			font-size: 0;
			color: #FFFFFF;
			background-color: rgba(0, 0, 0, 0.9);
			z-index: 1000;
		}
		.footer a,
		.footer input,
		.footer button,
		.footer label{
			color: inherit;
		}
		.footer-left{
			height: 24px;
			padding-left: 8px;
			float: left;
			font-size: 0.8rem;
		}
		.footer-right{
			height: 24px;
			float: right;
			padding-right: 8px;
			font-size: 0.8rem;
		}
		.footer-left,
		.footer-right{
			line-height: 24px;
		}
		.footer-right{
			white-space: nowrap;
			word-break: break-all;
		}

		/* custom click callback */
		.canvaaas-image.selected{

		}
		.canvaaas-image.selected .canvaaas-pivot{
			border-color: blue !important;
		}
		.canvaaas-image.selected .canvaaas-grid{
			border-color: blue !important;
		}
		.canvaaas-image.selected .canvaaas-border{
			border-color: blue !important;
		}
		.canvaaas-image.selected .canvaaas-handle-square{
			border-color: blue !important;
		}

		/* custom for uneditable handle */
		.canvaaas-image.uneditable{
			cursor: not-allowed;
		}
		.canvaaas-image.uneditable .canvaaas-pivot{
			border-color: red !important;
		}
		.canvaaas-image.uneditable .canvaaas-grid{
			border-color: red !important;
		}
		.canvaaas-image.uneditable .canvaaas-border{
			border-color: red !important;
		}
		/* .canvaaas-image.uneditable .canvaaas-overlay{
			display: block !important;
			background-color: red !important;
		} */
		.canvaaas-image.uneditable .canvaaas-handle{
			cursor: not-allowed;
		}
		.canvaaas-image.uneditable .canvaaas-handle-square{
			border-color: red !important;
		}


		/* popup */
		.popup{
			position: fixed;
			display: block;
			width: 128px;
			height: auto;
			z-index: 1001;
		}

		.popup .row{
			padding: 0 8px;
			height: auto;
			color: #FFF;
			font-size: 0.8rem;
			line-height: 24px;
			border-bottom: 1px solid #777;
			background-color: rgba(0, 0, 0, 0.7);
		}

		.popup .row a{
			display: block;
			width: 100%;
			color: inherit;
			text-decoration: none;
		}
		.popup .row a:hover{
			text-decoration: underline;
		}


	</style>
</head>

<body>
	<div style="height: 24px;"></div>
	<!-- header start -->
	<div class="header">
		<div class="tab">
			<div class="title">
				<span>canvaaas.js</span>
			</div>
			<div class="list" style="display: none;">
				<div class="row">
					<a href="javascript:void(0)" onclick="
						alert('Create by godicheol@gmail.com')
					">About this</a>
				</div>
				<div class="row">
					<a href="https://github.com/godicheol/canvaaas">Github</a>
				</div>
			</div>
		</div>
		<div class="tab">
			<div class="title">
				<span>File</span>
			</div>
			<div class="list" style="display: none;">
				<div class="row">
					<a href="javascript:void(0)" onclick="
						canvaaas.new({
							filename: window.prompt('Filename', 'untitled'),
							mimetype: window.prompt('Mimetype', 'image/png'),
							width: window.prompt('Width', '1800'),
							height: window.prompt('Height', '1800'),
							quality: window.prompt('Quality (e.g. 0 ~ 1)', '0.92'),
							background: window.prompt('Background (e.g. #000000 ~ #FFFFFF)', 'transparent'),
							checker: window.prompt('Checker (e.g. true, false)', 'true'),
							overlay: window.prompt('Overlay (e.g. true, false)', 'true'),
							ruler: window.prompt('Ruler (e.g. true, false)', 'false'),
						})
					">New</a>
				</div>
				<div class="row rule">
					<a href="javascript:void(0)" onclick="
						canvaaas.close()
					">Close</a>
				</div>
				<div class="row">
					<input id="uploadF" style="display: none;" type="file" accept="image/*" onchange="canvaaas.uploadFiles(this.files)" multiple>
					<label for="uploadF">Upload files</label>
				</div>
				<div class="row rule">
					<a href="javascript:void(0)" onclick="
						canvaaas.uploadUrls([window.prompt('URL', './img/1.png')])"
					>Upload URL</a>
				</div>
				<div class="row">
					<a href="javascript:void(0)" onclick="
						canvaaas.draw({
							filename: 'large',
							mimetype: 'image/jpeg'
						}, function(err, res){
							if (err) {return false;}
							canvaaas.debug(res);
						})
					">Preview</a>
				</div>
				<div class="row">
					<a href="javascript:void(0)" onclick="
						canvaaas.draw({
							filename: 'small',
							mimetype: 'image/jpeg',
							width: '256',
							height: '256',
							quality: 0.92,
							background: '#272727'
						}, function(err, res){
							if (err) {return false;}
							canvaaas.debug(res);
						})
					">Thumbnail</a>
				</div>
				<div class="row">
					<a href="javascript:void(0)" onclick="
						canvaaas.draw({
							filename: 'grayscale',
							mimetype: 'image/jpeg',
							filter: function(r, g, b, a) {
								var luma = r * 0.2126 + g * 0.7152 + b * 0.0722;
								return [luma, luma, luma, a];
							}
						}, function(err, res){
							if (err) {return false;}
							canvaaas.debug(res);
						})
					">Graycale</a>
				</div>
				<div class="row">
					<a href="javascript:void(0)" onclick="
						canvaaas.draw({
							filename: 'large',
							mimetype: 'image/jpeg',
							filter: function(r, g, b, a) {
								var tr = r *.393 + g *.769 + b *.189;
								var tg = r *.349 + g *.686 + b *.168;
								var tb = r *.272 + g *.534 + b *.131;
								return [tr, tg, tb, a];
							}
						}, function(err, res){
							if (err) {return false;}
							canvaaas.debug(res);
						})
					">Sepia</a>
				</div>
				<div class="row rule">
					<a href="javascript:void(0)" onclick="
						canvaaas.drawTo({
							filename: 'small',
							mimetype: 'image/jpeg',
							width: '256',
							height: '256',
							quality: 0.92,
							background: '#272727'
						}, function(err, res){
							if (err) {return false;}
							canvaaas.debug(res);
						})
					">From JSON</a>
				</div>
				<div class="row">
					<script>
						function myExport() {
							canvaaas.find({}, function(err, res){
								if (err) {
									alert(err);
									return false;
								}
								var arr = [];
								res.forEach(function(elem){
									arr.push(elem.id);
								})
								canvaaas.export(arr, function(err, res){
									if (err) {
										alert(err);
										return false;
									}
									console.log("canvaaas.export()", res)
									alert(JSON.stringify(res, null, 2));
								});
							})
						}
 					</script>
					<a href="javascript:void(0)" onclick="myExport()">Export</a>
				</div>
				<div class="row rule">
					<script>
						var a1 = {};
						var myImport = function() {
							canvaaas.import()
						}
					</script>
					<a class="disabled" href="javascript:void(0)" onclick="myImport()">Import()</a>
				</div>
				<div class="row">
					<a href="javascript:void(0)" onclick="
						canvaaas.init(document.getElementById('target'))
					">Init</a>
				</div>
				<div class="row">
					<a href="javascript:void(0)" onclick="
						canvaaas.destroy(function(err, res){
							if (err) {return false;}
							canvaaas.config(defaultConfig);
						})
					">Destroy</a>
				</div>
			</div>
		</div>
		<div class="tab">
			<div class="title">
				<span>Edit</span>
			</div>
			<div class="list" style="display: none;">
				<div class="row">
					<a id="myUndo" href="javascript:void(0)" onclick="
						canvaaas.undo()
					">Undo</a>
				</div>
				<div class="row rule">
					<a id="myRedo" href="javascript:void(0)" onclick="
						canvaaas.redo()
					">Redo</a>
				</div>
				<div class="row selection rule">
					<a href="javascript:void(0)" onclick="
						canvaaas.state(selectedId, {
							id: window.prompt('ID', selectedId)
						}, function(err, res){
							if (err) {return false;}
							selectedId = res.id;
							chkSelected();
						})
					">ID</a>
				</div>
				<div class="row selection">
					<a href="javascript:void(0)" onclick="
						canvaaas.addClass(selectedId, window.prompt('Class name', 'disabled'))
					">Add class name</a>
				</div>
				<div class="row selection rule">
					<a href="javascript:void(0)" onclick="
						canvaaas.removeClass(selectedId, window.prompt('Class name', 'disabled'))
					">Remove class name</a>
				</div>
				<div class="row selection">
					<a href="javascript:void(0)" onclick="
						canvaaas.index(selectedId, 1)
					">Index +1</a>
				</div>
				<div class="row selection rule">
					<a href="javascript:void(0)" onclick="
						canvaaas.index(selectedId, -1)
					">Index -1</a>
				</div>
				<div class="row selection">
					<a href="javascript:void(0)" onclick="
						canvaaas.moveY(selectedId, -10)
					">Move top 10</a>
				</div>
				<div class="row selection">
					<a href="javascript:void(0)" onclick="
						canvaaas.moveY(selectedId, 10)
					">Move bottom 10</a>
				</div>
				<div class="row selection">
					<a href="javascript:void(0)" onclick="
						canvaaas.moveX(selectedId, -10)
					">Move left 10</a>
				</div>
				<div class="row selection rule">
					<a href="javascript:void(0)" onclick="
						canvaaas.moveX(selectedId, 10)
					">Move right 10</a>
				</div>
				<div class="row selection">
					<a href="javascript:void(0)" onclick="
						canvaaas.zoom(selectedId, 1.1)
					">Zoom +0.1</a>
				</div>
				<div class="row selection rule">
					<a href="javascript:void(0)" onclick="
						canvaaas.zoom(selectedId, 0.9)
					">Zoom -0.1</a>
				</div>
				<div class="row selection">
					<a href="javascript:void(0)" onclick="
						canvaaas.cover(selectedId)
					">Cover</a>
				</div>
				<div class="row selection rule">
					<a href="javascript:void(0)" onclick="
						canvaaas.contain(selectedId)
					">Contain</a>
				</div>
				<div class="row selection">
					<a href="javascript:void(0)" onclick="
						canvaaas.flipX(selectedId)
					">Flip X</a>
				</div>
				<div class="row selection rule">
					<a href="javascript:void(0)" onclick="
						canvaaas.flipY(selectedId)
					">Flip Y</a>
				</div>
				<div class="row selection">
					<a href="javascript:void(0)" onclick="
						canvaaas.opacity(selectedId, 0.9)
					">Opacity 0.9</a>
				</div>
				<div class="row selection">
					<a href="javascript:void(0)" onclick="
						canvaaas.opacity(selectedId, 0.5)
					">Opacity 0.5</a>
				</div>
				<div class="row selection rule">
					<a href="javascript:void(0)" onclick="
						canvaaas.opacity(selectedId, 0.1)
					">Opacity 0.1</a>
				</div>
				<div class="row selection">
					<a href="javascript:void(0)" onclick="
						canvaaas.lockAspectRatio(selectedId)
					">Lock aspect ratio</a>
				</div>
				<div class="row selection">
					<a href="javascript:void(0)" onclick="
						canvaaas.visible(selectedId)
					">Visible</a>
				</div>
				<div class="row selection">
					<a href="javascript:void(0)" onclick="
						canvaaas.clickable(selectedId)
					">Clickable</a>
				</div>
				<div class="row selection">
					<a href="javascript:void(0)" onclick="
						canvaaas.editable(selectedId)
					">Editable</a>
				</div>
				<div class="row selection">
					<a href="javascript:void(0)" onclick="
						canvaaas.indexable(selectedId)
					">Indexable</a>
				</div>
				<div class="row selection">
					<a href="javascript:void(0)" onclick="
						canvaaas.movable(selectedId)
					">Movable</a>
				</div>
				<div class="row selection">
					<a href="javascript:void(0)" onclick="
						canvaaas.resizable(selectedId)
					">Resizable</a>
				</div>
				<div class="row selection">
					<a href="javascript:void(0)" onclick="
						canvaaas.rotatable(selectedId)
					">Rotatable</a>
				</div>
				<div class="row selection">
					<a href="javascript:void(0)" onclick="
						canvaaas.flippable(selectedId)
					">Flippable</a>
				</div>
				<div class="row selection">
					<a href="javascript:void(0)" onclick="
						canvaaas.croppable(selectedId)
					">Croppable</a>
				</div>
				<div class="row selection">
					<a href="javascript:void(0)" onclick="
						canvaaas.filterable(selectedId)
					">Filterable</a>
				</div>
				<div class="row selection">
					<a href="javascript:void(0)" onclick="
						canvaaas.removable(selectedId)
					">Removable</a>
				</div>
				<div class="row selection rule">
					<a href="javascript:void(0)" onclick="
						canvaaas.drawable(selectedId)
					">Drawable</a>
				</div>
				<div class="row selection">
					<a href="javascript:void(0)" onclick="
						canvaaas.border(selectedId)
					">Border</a>
				</div>
				<div class="row selection">
					<a href="javascript:void(0)" onclick="
						canvaaas.pivot(selectedId)
					">Pivot</a>
				</div>
				<div class="row selection rule">
					<a href="javascript:void(0)" onclick="
						canvaaas.grid(selectedId)
					">Grids</a>
				</div>
				<div class="row selection">
					<a class="" href="javascript:void(0)" onclick="
						canvaaas.filter(selectedId, function(r, g, b, a) {
							var luma = r * 0.2126 + g * 0.7152 + b * 0.0722;
							return [luma, luma, luma, a];
						})
					">Filter grayscale</a>
				</div>
				<div class="row selection rule">
					<a class="" href="javascript:void(0)" onclick="
						canvaaas.filter(selectedId, function(r, g, b, a) {
							var tr = r - 40;
							var tg = g - 40;
							var tb = b - 40;
							return [tr, tg, tb, a];
						})
					">Filter brightness</a>
				</div>
				<div class="row selection">
					<a href="javascript:void(0)" onclick="
						canvaaas.reset(selectedId)
					">Reset</a>
				</div>
				<div class="row selection rule">
					<a href="javascript:void(0)" onclick="
						canvaaas.remove(selectedId)
					">Remove</a>
				</div>
			</div>
		</div>
		<div class="tab">
			<div class="title">
				<span>Canvas</span>
			</div>
			<div class="list" style="display: none;">
				<div class="row rule">
					<a href="javascript:void(0)" onclick="
						canvaaas.canvas({
							width: window.prompt('Width (e.g. 1200)', canvaaas.getCanvas().width),
							height: window.prompt('Height (e.g. 1200)', canvaaas.getCanvas().height)
						})
					">Resize</a>
				</div>
				<div class="row">
					<a href="javascript:void(0)" onclick="
						canvaaas.addClassToCanvas(window.prompt('Class name'))
					">Add class name</a>
				</div>
				<div class="row rule">
					<a href="javascript:void(0)" onclick="
						canvaaas.removeClassToCanvas(window.prompt('Class name'))
					">Remove class name</a>
				</div>
				<div class="row">
					<a href="javascript:void(0)" onclick="
						canvaaas.canvas({
							filename: window.prompt('Filename', canvaaas.getCanvas().filename)
						})
					">Filename</a>
				</div>
				<div class="row">
					<a href="javascript:void(0)" onclick="
						canvaaas.canvas({
							mimetype: window.prompt('Mimetype', canvaaas.getCanvas().mimetype)
						})
					">Mimetype</a>
				</div>
				<div class="row">
					<a href="javascript:void(0)" onclick="
						canvaaas.canvas({
							quality: window.prompt('Quality (e.g. 0 ~ 1)', canvaaas.getCanvas().quality)
						})
					">Quality</a>
				</div>
				<div class="row">
					<a href="javascript:void(0)" onclick="
						canvaaas.canvas({
							background: window.prompt('background (e.g. #272727)', canvaaas.getCanvas().background)
						})
					">Background</a>
				</div>
				<div class="row">
					<a href="javascript:void(0)" onclick="
						canvaaas.canvas({
							uploadable: canvaaas.getCanvas().uploadable === false
						})
					">Uploadable</a>
				</div>
				<div class="row">
					<a href="javascript:void(0)" onclick="
						canvaaas.canvas({
							clickable: canvaaas.getCanvas().clickable === false
						})
					">Clickable</a>
				</div>
				<div class="row">
					<a href="javascript:void(0)" onclick="
						canvaaas.canvas({
							editable: canvaaas.getCanvas().editable === false
						})
					">Editable</a>
				</div>
				<div class="row">
					<a href="javascript:void(0)" onclick="
						canvaaas.canvas({
							overlay: canvaaas.getCanvas().overlay === false
						})
					">Overlay</a>
				</div>
				<div class="row">
					<a href="javascript:void(0)" onclick="
						canvaaas.canvas({
							checker: canvaaas.getCanvas().checker === false
						})
					">Checker</a>
				</div>
				<div class="row">
					<a href="javascript:void(0)" onclick="
						canvaaas.canvas({
							ruler: canvaaas.getCanvas().ruler === false
						})
					">Ruler</a>
				</div>
			</div>
		</div>
		<div class="tab">
			<div class="title">
				<span>View</span>
			</div>
			<div class="list" style="display: none;">
				<div class="row">
					<a href="javascript:void(0)" onclick="
						canvaaas.find({}, function(err, res){
							if (err) {return false;}
							res.forEach(function(elem){
								canvaaas.handle(elem.id, {
									'n': 'resize',
									'ne': 'resize',
									'e': 'resize',
									'se': 'resize',
									's': 'resize',
									'sw': 'resize',
									'w': 'resize',
									'nw': 'resize',
									'nn': 'rotate',
									'nene': 'crop',
									'ee': 'flip',
									'sese': 'crop',
									'ss': 'flip',
									'swsw': 'crop',
									'ww': 'rotate',
									'nwnw': 'crop',
								})
							})
						})
					">Handle style default</a>
				</div>
				<div class="row">
					<a href="javascript:void(0)" onclick="
						canvaaas.find({}, function(err, res){
							if (err) {return false;}
							res.forEach(function(elem){
								canvaaas.handle(elem.id, {
									'n': 'resize',
									'ne': 'resize',
									'e': 'resize',
									'se': 'resize',
									's': 'resize',
									'sw': 'resize',
									'w': 'resize',
									'nw': 'resize',
									'nn': 'rotate',
									'ee': 'flip',
								})
							})
						})
					">Handle style 1</a>
				</div>
				<div class="row">
					<a href="javascript:void(0)" onclick="
						canvaaas.find({}, function(err, res){
							if (err) {return false;}
							res.forEach(function(elem){
								canvaaas.handle(elem.id, {
									'n': 'crop',
									'ne': 'crop',
									'e': 'crop',
									'se': 'crop',
									's': 'crop',
									'sw': 'crop',
									'w': 'crop',
									'nw': 'crop',
									'nn': 'rotate',
									'ee': 'flip',
								})
							})
						})
					">Handle style 2</a>
				</div>
				<div class="row">
					<a href="javascript:void(0)" onclick="
						canvaaas.find({}, function(err, res){
							if (err) {return false;}
							res.forEach(function(elem){
								canvaaas.handle(elem.id, {
									'n': 'resize',
									'ne': 'resize',
									'e': 'resize',
									'se': 'resize',
									's': 'resize',
									'sw': 'resize',
									'w': 'resize',
									'nw': 'resize',
								})
							})
						})
					">Handle style 3</a>
				</div>
				<div class="row">
					<a href="javascript:void(0)" onclick="
						canvaaas.find({}, function(err, res){
							if (err) {return false;}
							res.forEach(function(elem){
								canvaaas.handle(elem.id, {
									'n': 'crop',
									'ne': 'crop',
									'e': 'crop',
									'se': 'crop',
									's': 'crop',
									'sw': 'crop',
									'w': 'crop',
									'nw': 'crop',
								})
							})
						})
					">Handle style 4</a>
				</div>
				<div class="row">
					<a href="javascript:void(0)" onclick="
						canvaaas.find({}, function(err, res){
							if (err) {return false;}
							res.forEach(function(elem){
								canvaaas.handle(elem.id, {
									'ne': 'resize',
									'se': 'resize',
									'sw': 'resize',
									'nw': 'resize',
								})
							})
						})
					">Handle style 5</a>
				</div>
				<div class="row">
					<a href="javascript:void(0)" onclick="
						canvaaas.find({}, function(err, res){
							if (err) {return false;}
							res.forEach(function(elem){
								canvaaas.handle(elem.id, {
									'ne': 'crop',
									'se': 'crop',
									'sw': 'crop',
									'nw': 'crop',
								})
							})
						})
					">Handle style 6</a>
				</div>
				<div class="row">
					<a href="javascript:void(0)" onclick="
						canvaaas.find({}, function(err, res){
							if (err) {return false;}
							res.forEach(function(elem){
								canvaaas.handle(elem.id, {
									'n': 'resize',
									'e': 'resize',
									's': 'resize',
									'w': 'resize',
								})
							})
						})
					">Handle style 7</a>
				</div>
				<div class="row">
					<a href="javascript:void(0)" onclick="
						canvaaas.find({}, function(err, res){
							if (err) {return false;}
							res.forEach(function(elem){
								canvaaas.handle(elem.id, {
									'n': 'crop',
									'e': 'crop',
									's': 'crop',
									'w': 'crop',
								})
							})
						})
					">Handle style 8</a>
				</div>
				<div class="row">
					<a href="javascript:void(0)" onclick="
						canvaaas.find({}, function(err, res){
							if (err) {return false;}
							res.forEach(function(elem){
								canvaaas.handle(elem.id, {})
							})
						})
					">Handle style 9</a>
				</div>
				<div class="row">
					<a href="javascript:void(0)" onclick="
						canvaaas.find({}, function(err, res){
							if (err) {return false;}
							res.forEach(function(elem){
								canvaaas.handle(elem.id, {
									'n': 'click',
									'ne': 'click',
									'e': 'click',
									'se': 'click',
									's': 'click',
									'sw': 'click',
									'w': 'click',
									'nw': 'click',
									'nn': 'click',
									'nene': 'click',
									'ee': 'click',
									'sese': 'click',
									'ss': 'click',
									'swsw': 'click',
									'ww': 'click',
									'nwnw': 'click',
								})
							})
						})
					">Handle style click</a>
				</div>
			</div>
		</div>
		<div class="tab">
			<div class="title">
				<span>Console</span>
			</div>
			<div class="list" style="display: none;">
				<div class="row">
					<a href="javascript:void(0)" onclick="
						canvaaas.find({
							id: window.prompt('id', 'id')
						}, function(err, res){
							if (err) {return false;}
							alert(JSON.stringify(res, null, 2));
						})
					">Find for id</a>
				</div>
				<div class="row">
					<a href="javascript:void(0)" onclick="
						canvaaas.find({
							index: window.prompt('index', '1')
						}, function(err, res){
							if (err) {return false;}
							alert(JSON.stringify(res, null, 2));
						})
					">Find for index</a>
				</div>
				<div class="row rule">
					<a href="javascript:void(0)" onclick="
						canvaaas.find({
							visible: window.prompt('visible (e.g. `true`, `false`)', 'true')
						}, function(err, res){
							if (err) {return false;}
							alert(JSON.stringify(res, null, 2));
						})
					">Find for visible</a>
				</div>
				<div class="row">
					<a href="javascript:void(0)" onclick="
						canvaaas.getConfig(function(err, res){
							console.log('canvaaas.getConfig()', res);
						})
					">Get config data</a>
				</div>
				<div class="row">
					<a href="javascript:void(0)" onclick="
						canvaaas.getCanvas(function(err, res){
							console.log('canvaaas.getCanvas()', res);
						})
					">Get canvas data</a>
				</div>
				<div class="row">
					<a href="javascript:void(0)" onclick="
						canvaaas.getImages(function(err, res){
							console.log('canvaaas.getImages()', res);
						})
					">Get images data</a>
				</div>
				<div class="row">
					<a href="javascript:void(0)" onclick="
						canvaaas.getUndo(function(err, res){
							console.log('canvaaas.getUndo()', res);
						})
					">Get undo data</a>
				</div>
				<div class="row">
					<a href="javascript:void(0)" onclick="
						canvaaas.getRedo(function(err, res){
							console.log('canvaaas.getRedo()', res);
						})
					">Get redo data</a>
				</div>
				<div class="row">
					<a href="javascript:void(0)" onclick="
						canvaaas.getLimit(function(err, res){
							console.log('canvaaas.getLimit()', res);
						})
					">Get limit data</a>
				</div>
			</div>
		</div>
	</div>
	<!-- header end -->

	<!-- main -->
	<div id="target"></div>

	<div id="myHelp" style=""></div>
	<div id="myDebug" style=""></div>

	<!-- controller -->
	<div class="ctrl">
		<div class="row">
			<a
				class="tool"
				href="javascript:void(0)"
				onclick="selectTool(this)"
				data-method="index"
				data-value="1"
				data-help="Index up"
				>
				<span class="material-icons">
					thumb_up
				</span>
			</a>
		</div>
		<div class="row">
			<a
				class="tool"
				href="javascript:void(0)"
				onclick="selectTool(this)"
				data-method="index"
				data-value="-1"
				data-help="Index down"
				>
				<span class="material-icons">
					thumb_down
				</span>
			</a>
		</div>
		<div class="row">
			<a
				class="tool"
				href="javascript:void(0)"
				onclick="selectTool(this)"
				data-method="crop"
				data-value=""
				data-help="Crop mode"
				>
				<span class="material-icons">
					crop
				</span>
			</a>
		</div>
		<div class="row">
			<a
				class="tool"
				href="javascript:void(0)"
				onclick="selectTool(this)"
				data-method="resize"
				data-value=""
				data-help="Resize mode"
				>
				<span class="material-icons">
					transform
				</span>
			</a>
		</div>
		<div class="row">
			<a
				class="tool"
				href="javascript:void(0)"
				onclick="selectTool(this)"
				data-method="moveY"
				data-value="-10"
				data-help="Move top 10px"
				>
				<span class="material-icons">expand_less</span>
			</a>
		</div>
		<div class="row">
			<a
				class="tool"
				href="javascript:void(0)"
				onclick="selectTool(this)"
				data-method="moveY"
				data-value="10"
				data-help="Move bottom 10px"
				>
				<span class="material-icons">expand_more</span>
			</a>
		</div>
		<div class="row">
			<a
				class="tool"
				href="javascript:void(0)"
				onclick="selectTool(this)"
				data-method="moveX"
				data-value="-10"
				data-help="Move left 10px"
				>
				<span class="material-icons">
					navigate_before
				</span>
			</a>
		</div>
		<div class="row">
			<a
				class="tool"
				href="javascript:void(0)"
				onclick="selectTool(this)"
				data-method="moveX"
				data-value="10"
				data-help="Move right 10px"
				>
				<span class="material-icons">
					navigate_next
				</span>
			</a>
		</div>
		<div class="row">
			<a
				class="tool"
				href="javascript:void(0)"
				onclick="selectTool(this)"
				data-method="zoom"
				data-value="1.1"
				data-help="Zoom in 10%"
				>
				<span class="material-icons">
					zoom_in
				</span>
			</a>
		</div>
		<div class="row">
			<a
				class="tool"
				href="javascript:void(0)"
				onclick="selectTool(this)"
				data-method="zoom"
				data-value="0.9"
				data-help="Zoom out 10%"
				>
				<span class="material-icons">
					zoom_out
				</span>
			</a>
		</div>
		<div class="row">
			<a
				class="tool"
				href="javascript:void(0)"
				onclick="selectTool(this)"
				data-method="cover"
				data-value=""
				data-help="Cover to canvas"
				>
				<span class="material-icons">
					open_in_full
				</span>
			</a>
		</div>
		<div class="row">
			<a
				class="tool"
				href="javascript:void(0)"
				onclick="selectTool(this)"
				data-method="contain"
				data-value=""
				data-help="Contain to canvas"
				>
				<span class="material-icons">
					open_in_full
				</span>
			</a>
		</div>
		<div class="row">
			<a
				class="tool"
				href="javascript:void(0)"
				onclick="selectTool(this)"
				data-method="rotate"
				data-value="45"
				data-help="Rotate right 45 deg"
				>
				<span class="material-icons">
					rotate_right
				</span>
			</a>
		</div>
		<div class="row">
			<a
				class="tool"
				href="javascript:void(0)"
				onclick="selectTool(this)"
				data-method="rotate"
				data-value="-45"
				data-help="Rotate left 45 deg"
				>
				<span class="material-icons">
					rotate_left
				</span>
			</a>
		</div>
		<div class="row">
			<a
				class="tool"
				href="javascript:void(0)"
				onclick="selectTool(this)"
				data-method="flipY"
				data-value=""
				data-help="Flip horizontal"
				>
				<span class="material-icons">
					flip
				</span>
			</a>
		</div>
		<div class="row">
			<a
				class="tool"
				href="javascript:void(0)"
				onclick="selectTool(this)"
				data-method="flipX"
				data-value=""
				data-help="Flip vertical"
				>
				<span class="material-icons" style="transform: rotate(90deg);">
					flip
				</span>
			</a>
		</div>
		<div class="row">
			<a
				class="tool"
				href="javascript:void(0)"
				onclick="selectTool(this)"
				data-method="opacity"
				data-value="-0.1"
				data-help="Opacity -0.1"
				>
				<span class="material-icons">
					opacity
				</span>
			</a>
		</div>
		<div class="row">
			<a
				class="tool"
				href="javascript:void(0)"
				onclick="selectTool(this)"
				data-method="opacity"
				data-value="0.1"
				data-help="Opacity +0.1"
				>
				<span class="material-icons">
					invert_colors_off
				</span>
			</a>
		</div>
		<div class="row">
			<a
				class="tool"
				href="javascript:void(0)"
				onclick="selectTool(this)"
				data-method="lockAspectRatio"
				data-value=""
				data-help="Lock aspect ratio"
				>
				<span class="material-icons">
					aspect_ratio
				</span>
			</a>
		</div>
		<div class="row">
			<a
				class="tool"
				href="javascript:void(0)"
				onclick="selectTool(this)"
				data-method="visible"
				data-value=""
				data-help="Visible"
				>
				<span class="material-icons">
					visibility_off
				</span>
			</a>
		</div>
		<div class="row">
			<a
				class="tool"
				href="javascript:void(0)"
				onclick="selectTool(this)"
				data-method="clickable"
				data-value=""
				data-help="Clickable"
				>
				<span class="material-icons">
					do_not_touch
				</span>
			</a>
		</div>
		<div class="row">
			<a
				class="tool"
				href="javascript:void(0)"
				onclick="selectTool(this)"
				data-method="editable"
				data-value=""
				data-help="Editable"
				>
				<span class="material-icons">
					edit_off
				</span>
			</a>
		</div>
		<div class="row">
			<a
				class="tool"
				href="javascript:void(0)"
				onclick="selectTool(this)"
				data-method="indexable"
				data-value=""
				data-help="Indexable"
				>
				<span class="material-icons">
					edit_off
				</span>
			</a>
		</div>
		<div class="row">
			<a
				class="tool"
				href="javascript:void(0)"
				onclick="selectTool(this)"
				data-method="movable"
				data-value=""
				data-help="Movable"
				>
				<span class="material-icons">
					edit_off
				</span>
			</a>
		</div>
		<div class="row">
			<a
				class="tool"
				href="javascript:void(0)"
				onclick="selectTool(this)"
				data-method="resizable"
				data-value=""
				data-help="Resizable"
				>
				<span class="material-icons">
					edit_off
				</span>
			</a>
		</div>
		<div class="row">
			<a
				class="tool"
				href="javascript:void(0)"
				onclick="selectTool(this)"
				data-method="rotatable"
				data-value=""
				data-help="Rotatable"
				>
				<span class="material-icons">
					edit_off
				</span>
			</a>
		</div>
		<div class="row">
			<a
				class="tool"
				href="javascript:void(0)"
				onclick="selectTool(this)"
				data-method="flippable"
				data-value=""
				data-help="Flippable"
				>
				<span class="material-icons">
					edit_off
				</span>
			</a>
		</div>
		<div class="row">
			<a
				class="tool"
				href="javascript:void(0)"
				onclick="selectTool(this)"
				data-method="croppable"
				data-value=""
				data-help="Croppable"
				>
				<span class="material-icons">
					edit_off
				</span>
			</a>
		</div>
		<div class="row">
			<a
				class="tool"
				href="javascript:void(0)"
				onclick="selectTool(this)"
				data-method="filterable"
				data-value=""
				data-help="Filterable"
				>
				<span class="material-icons">
					edit_off
				</span>
			</a>
		</div>
		<div class="row">
			<a
				class="tool"
				href="javascript:void(0)"
				onclick="selectTool(this)"
				data-method="removable"
				data-value=""
				data-help="Removable"
				>
				<span class="material-icons">
					edit_off
				</span>
			</a>
		</div>
		<div class="row">
			<a
				class="tool"
				href="javascript:void(0)"
				onclick="selectTool(this)"
				data-method="drawable"
				data-value=""
				data-help="Drawable"
				>
				<span class="material-icons">
					file_download_off
				</span>
			</a>
		</div>
		<div class="row">
			<a
				class="tool"
				href="javascript:void(0)"
				onclick="selectTool(this)"
				data-method="remove"
				data-value=""
				data-help="Remove"
				>
				<span class="material-icons">
					delete
				</span>
			</a>
		</div>
		<div class="row">
			<a
				class="tool"
				href="javascript:void(0)"
				onclick="selectTool(this)"
				data-method="border"
				data-value=""
				data-help="Border"
				>
				<span class="material-icons">
					border_style
				</span>
			</a>
		</div>
		<div class="row">
			<a
				class="tool"
				href="javascript:void(0)"
				onclick="selectTool(this)"
				data-method="grid"
				data-value=""
				data-help="Grid"
				>
				<span class="material-icons">
					grid_3x3
				</span>
			</a>
		</div>
		<div class="row">
			<a
				class="tool"
				href="javascript:void(0)"
				onclick="selectTool(this)"
				data-method="pivot"
				data-value=""
				data-help="Pivot"
				>
				<span class="material-icons">
					adjust
				</span>
			</a>
		</div>
		<div class="row">
			<a
				class="tool"
				href="javascript:void(0)"
				onclick="selectTool(this)"
				data-method="filter-grayscale"
				data-value=""
				data-help="Filter grayscale"
				>
				<span class="material-icons">
					join_right
				</span>
			</a>
		</div>
		<div class="row">
			<a
				class="tool"
				href="javascript:void(0)"
				onclick="selectTool(this)"
				data-method="filter-sepia"
				data-value=""
				data-help="Filter sepia"
				>
				<span class="material-icons">
					join_right
				</span>
			</a>
		</div>
		<div class="row">
			<a
				class="tool"
				href="javascript:void(0)"
				onclick="selectTool(this)"
				data-method="filter-negative"
				data-value=""
				data-help="Filter negative"
				>
				<span class="material-icons">
					join_right
				</span>
			</a>
		</div>
		<div class="row">
			<a
				class="tool"
				href="javascript:void(0)"
				onclick="selectTool(this)"
				data-method="filter-brightness"
				data-value=""
				data-help="Filter brightness"
				>
				<span class="material-icons">
					join_right
				</span>
			</a>
		</div>
		<div class="row">
			<a
				class="tool"
				href="javascript:void(0)"
				onclick="selectTool(this)"
				data-method="filter-darkness"
				data-value=""
				data-help="Filter drakness"
				>
				<span class="material-icons">
					join_right
				</span>
			</a>
		</div>
		<div class="row">
			<a
				class="tool"
				href="javascript:void(0)"
				onclick="selectTool(this)"
				data-method="filter-contrast"
				data-value=""
				data-help="Filter contrast"
				>
				<span class="material-icons">
					join_right
				</span>
			</a>
		</div>
		<div class="row">
			<a
				class="tool"
				href="javascript:void(0)"
				onclick="selectTool(this)"
				data-method="filter-unset"
				data-value=""
				data-help="Filter unset"
				>
				<span class="material-icons">
					switch_access_shortcut
				</span>
			</a>
		</div>
		<div class="row">
			<a
				class="tool"
				href="javascript:void(0)"
				onclick="selectTool(this)"
				data-method="drawable-hide"
				data-value=""
				data-help="Hide undrawable images"
				>
				<span class="material-icons">
					visibility_off
				</span>
			</a>
		</div>
		<div class="row">
			<a
				class="tool"
				href="javascript:void(0)"
				onclick="selectTool(this)"
				data-method="drawable-show"
				data-value=""
				data-help="Show undrawable images"
				>
				<span class="material-icons">
					visibility
				</span>
			</a>
		</div>
		<div class="row">
			<a
				class="tool"
				href="javascript:void(0)"
				onclick="selectTool(this)"
				data-method="ruler"
				data-value=""
				data-help="Ruler"
				>
				<span class="material-icons">
					straighten
				</span>
			</a>
		</div>
	</div>
	<style>
		/* controller */
		.ctrl{
			position: absolute;
			display: block;
			top: 24px;
			left: 0;
			width: 72px;
			max-height: calc(100% - 48px);
			text-align: center;
			z-index: 1000;
		}
		.ctrl .row{
			display: inline-block;
			float: left;
		}
		.ctrl .row a{
			display: block;
			padding: 4px;
			font-size: initial;
			color: #000000;
		}
		.ctrl .row a.selected{
			background-color: #000000;
			color: #FFFFFF;
		}
		@media only screen and (max-width: 768px) {
			.ctrl{
				top: auto;
				bottom: 48px;
				width: 100%;
				overflow-y: auto;
			}
		}
	</style>
	<script>
		var tool;
		var hlp = document.getElementById("myHelp");

		function selectTool(self) {
			var m = self.getAttribute("data-method");
			var v = self.getAttribute("data-value");
			var t = self.getAttribute("data-help");
			hlp.innerHTML = t;

			switch(m) {
				case "resize":
					canvaaas.find({}, function(err, res){
						if (err) {return false;}
						res.forEach(function(elem){
							canvaaas.handle(elem.id, {
								'n': 'resize',
								'ne': 'resize',
								'e': 'resize',
								'se': 'resize',
								's': 'resize',
								'sw': 'resize',
								'w': 'resize',
								'nw': 'resize',
							})
						})
					})
					if (tool) {
						cancelTool(tool);
					}
					return false;
					break;
				case "crop":
					canvaaas.find({}, function(err, res){
						if (err) {return false;}
						res.forEach(function(elem){
							canvaaas.handle(elem.id, {
								'n': 'crop',
								'ne': 'crop',
								'e': 'crop',
								'se': 'crop',
								's': 'crop',
								'sw': 'crop',
								'w': 'crop',
								'nw': 'crop',
							})
						})
					})
					if (tool) {
						cancelTool(tool);
					}
					return false;
					break;
				case "ruler":
					canvaaas.canvas({
						ruler: canvaaas.getCanvas().ruler === false
					})
					if (tool) {
						cancelTool(tool);
					}
					return false;
					break;
				case "drawable-hide":
					canvaaas.find({
						drawable: false,
						visible: true
					}, function(err, res){
						if (err) {return false;}
						res.forEach(function(elem){
							canvaaas.state(elem.id, {visible: false});
						})
					})
					if (tool) {
						cancelTool(tool);
					}
					return false;
					break;
				case "drawable-show":
					canvaaas.find({
						drawable: false,
						visible: false
					}, function(err, res){
						if (err) {return false;}
						res.forEach(function(elem){
							canvaaas.state(elem.id, {visible: true});
						})
					})
					if (tool) {
						cancelTool(tool);
					}
					return false;
					break;
			}

			if (tool) {
				cancelTool(tool);
			}

			tool = self;

			if (!self.classList.contains("selected")) {
				self.classList.add("selected");
			}
		}

		function cancelTool(self) {
			if (self.classList.contains("selected")) {
				self.classList.remove("selected");
			}
			tool = undefined;
		}
	</script>

	<!-- footer start -->
	<div class="footer">
		<div class="footer-left">
			<span id="myIndex">(Index)</span>
			<span id="myId">ID</span>
		</div>
		<div class="footer-right">
			<!-- <span id="myDrawable" style="color: #FFFFFF;">Drawable</span>
			/
			<span id="myEditable" style="color: #FFFFFF;">Editable</span>
			/
			<span id="myLockAspectRatio" style="color: #FFFFFF;">Lock Aspect Ratio</span>
			/ -->
			<span id="myX">X</span>
			/
			<span id="myY">Y</span>
			/
			<span id="myWidth">Width</span>
			/
			<span id="myHeight">Height</span>
			/
			<span id="myRotate">Rotate</span>
			/
			<span id="myFlipX">FlipX</span>
			/
			<span id="myFlipY">FlipY</span>
			/
			<span id="myOpacity">Opacity</span>
		</div>
		<div style="clear: both"></div>
	</div>
	<!-- footer end -->


	<script>

		// 
		// utils
		// 

		var viewportSizes = canvaaas.getViewport();
		var selectedId;


		// 
		// main
		// 

		// #1 init
		canvaaas.init(document.getElementById("target"), function(err, res){
			if (err) {return false;}
			console.log("canvaaas.init()", res);
		});

		// #2 config
		var defaultConfig = {
			allowedMimeTypesForUpload: [
				"image/bmp",
				"image/x-ms-bmp",
				"image/jpg",
				"image/jpeg",
				"image/png",
				"image/gif",
				"image/svg",
				"image/svg+xml",
				"image/tiff",
				"image/tif",
				"image/webp",
			], // array of allowed mimetypes
			cacheLevels: 999, // number
			aspectRatioOfContainer: undefined, // number, width / height
			maxWidthOfContainer: undefined, // number, px
			maxHeightOfContainer: undefined, // number, px
			startIndexAfterRender: 1, // number
			maxIndexAfterRender: 1000, // number
			imageScaleAfterRender: 0.5, // number, 0 ~ 1 scale in canvas
			lockAspectRatioAfterRender: false, // boolean
			showBorderAfterRender: true, // boolean
			showGridAfterRender: true, // boolean
			showPivotAfterRender: true, // boolean
			showHandleAfterRender: {}, // object
			click: function(err, res) {
				if (err) {return false;}
				console.log("click", res);
				selectedId = res.id;
				canvaaas.addClass(selectedId, "selected");
				chkSelected();

				if (tool) {
					var m = tool.getAttribute("data-method");
					var v = tool.getAttribute("data-value");
					var id = res.id;
					switch(m) {
						case "index":
							canvaaas.index(id, v)
							break;
						case "moveX":
							canvaaas.moveX(id, v)
							break;
						case "moveY":
							canvaaas.moveY(id, v)
							break;
						case "zoom":
							canvaaas.zoom(id, v)
							break;
						case "rotate":
							canvaaas.rotate(id, v)
							break;
						case "flipX":
							canvaaas.flipX(id)
							break;
						case "flipY":
							canvaaas.flipY(id)
							break;
						case "opacity":
							canvaaas.opacity(id, v)
							break;
						case "lockAspectRatio":
							canvaaas.lockAspectRatio(id)
							cancelTool(tool);
							break;
						case "visible":
							canvaaas.visible(id)
							cancelTool(tool);
							break;
						case "clickable":
							canvaaas.clickable(id)
							cancelTool(tool);
							break;
						case "editable":
							canvaaas.editable(id)
							cancelTool(tool);
							break;
						case "indexable":
							canvaaas.indexable(id)
							cancelTool(tool);
							break;
						case "movable":
							canvaaas.movable(id)
							cancelTool(tool);
							break;
						case "resizable":
							canvaaas.resizable(id)
							cancelTool(tool);
							break;
						case "rotatable":
							canvaaas.rotatable(id)
							cancelTool(tool);
							break;
						case "flippable":
							canvaaas.flippable(id)
							cancelTool(tool);
							break;
						case "croppable":
							canvaaas.croppable(id)
							cancelTool(tool);
							break;
						case "filterable":
							canvaaas.filterable(id)
							cancelTool(tool);
							break;
						case "removable":
							canvaaas.removable(id)
							cancelTool(tool);
							break;
						case "drawable":
							canvaaas.drawable(id)
							cancelTool(tool);
							break;
						case "reset":
							canvaaas.reset(id)
							cancelTool(tool);
							break;
						case "remove":
							canvaaas.remove(id)
							cancelTool(tool);
							break;
						case "border":
							canvaaas.border(id)
							cancelTool(tool);
							break;
						case "grid":
							canvaaas.grid(id)
							cancelTool(tool);
							break;
						case "pivot":
							canvaaas.pivot(id)
							cancelTool(tool);
							break;
						case "cover":
							canvaaas.cover(id)
							cancelTool(tool);
							break;
						case "contain":
							canvaaas.contain(id)
							cancelTool(tool);
							break;
						case "filter-grayscale":
							canvaaas.filter(id, function(r, g, b, a) {
								var luma = r * 0.2126 + g * 0.7152 + b * 0.0722;
								return [luma, luma, luma, a];
							})
							cancelTool(tool);
							break;
						case "filter-sepia":
							canvaaas.filter(id, function(r, g, b, a) {
								var tr = r *.393 + g *.769 + b *.189;
								var tg = r *.349 + g *.686 + b *.168;
								var tb = r *.272 + g *.534 + b *.131;
								return [tr, tg, tb, a];
							})
							cancelTool(tool);
							break;
						case "filter-negative":
							canvaaas.filter(id, function(r, g, b, a) {
								var tr = 255 - r;
								var tg = 255 - g;
								var tb = 255 - b;
								return [tr, tg, tb, a];
							})
							cancelTool(tool);
							break;
						case "filter-brightness":
							canvaaas.filter(id, function(r, g, b, a) {
								var tr = r - 40;
								var tg = g - 40;
								var tb = b - 40;
								return [tr, tg, tb, a];
							})
							cancelTool(tool);
							break;
						case "filter-darkness":
							canvaaas.filter(id, function(r, g, b, a) {
								var tr = r + 40;
								var tg = g + 40;
								var tb = b + 40;
								return [tr, tg, tb, a];
							})
							cancelTool(tool);
							break;
						case "filter-contrast":
							canvaaas.filter(id, function(r, g, b, a) {
								var contrast = 10; // %
								contrast *= 255 / 100;
								var factor = (255 + contrast) / (255.01 - contrast);
								var tr = factor * (r - 128) + 128;
								var tg = factor * (g - 128) + 128;
								var tb = factor * (b - 128) + 128;
								return [tr, tg, tb, a];
							})
							cancelTool(tool);
							break;
						case "filter-unset":
							canvaaas.filter(id, null)
							cancelTool(tool);
							break;
					}
				}
			},
			rightClick: function(err, e, res) {
				if (err) {return false;}

				var id = res.id;
				var mouseX;
				var mouseY;
				if (typeof(e.touches) === "undefined") {
					mouseX = e.clientX;
					mouseY = e.clientY;
				} else if(e.touches.length === 1) {
					mouseX = e.touches[0].clientX;
					mouseY = e.touches[0].clientY;
				} else {
					return false;
				}
				var viewportSizes = canvaaas.getViewport();
				var posX;
				var posY;
				if (mouseX < 0.5 * viewportSizes.width) {
					posX = "left: " + (mouseX) + "px;";
				} else {
					posX = "right: " + (viewportSizes.width - mouseX) + "px;";
				}
				if (mouseY < 0.5 * viewportSizes.height) {
					posY = "top: " + (mouseY) + "px;";
				} else {
					posY = "bottom: " + (viewportSizes.height - mouseY) + "px;";
				}

				console.log("right click", res);

				popup = openPopup(id, posX, posY);
			},
			clickHandle: function(err, res, d) {
				if (err) {return false;}
				// example
				if (d === "w-w") {
					canvaaas.editable(res.id);
				} else if (d === "s-s") {
					canvaaas.lockAspectRatio(res.id);
				}
			},
			edit: function(err, res) {
				if (err) {return false;}
				chkCache();
				if (res.id === selectedId) {
					chkSelected();
				}

				if (!res.clickable) {
					canvaaas.addClass(selectedId, "unclickable");
				} else {
					canvaaas.removeClass(selectedId, "unclickable");
				}

				if (!res.editable) {
					canvaaas.addClass(selectedId, "uneditable");
				} else {
					canvaaas.removeClass(selectedId, "uneditable");
				}

				if (!res.drawable) {
					canvaaas.addClass(selectedId, "undrawable");
				} else {
					canvaaas.removeClass(selectedId, "undrawable");
				}
			},
			upload: function(err, res) {
				if (err) {return false;}
			},
			remove: function(err, res) {
				if (err) {return false;}
				if (res.id === selectedId) {
					selectedId = undefined;
					chkSelected();
				}
			},
		}
		canvaaas.config(defaultConfig, function(err, res){
			if (err) {return false;}
			console.log("canvaaas.config()", res);
		});

		// #3 create canvas
		canvaaas.new({
			filename: "untitled", // string, without extension
			mimetype: "image/png", // string
			quality: 0.92, // number, 0 ~ 1
			background: "transparent", // string, "transparent" or "#FFFFFF" ~ "#000000"
			overlay: true, // boolean
			checker: true, // boolean
			clickable: true, // boolean
			editable: true, // boolean
			ruler: false, // boolean
			width: 1200,
			height: 1200,
		}, function (err, res) {
			if (err) {return false;}
			console.log("canvaaas.new()", res);
		});

		// 
		// focus
		// 



		// 
		// cache
		// 

		function chkCache() {
			var u = document.getElementById("myUndo");
			var r = document.getElementById("myRedo");
			if (canvaaas.getUndo().length < 1) {
				u.classList.add("disabled");
			} else {
				u.classList.remove("disabled");
			}
			if (canvaaas.getRedo().length < 1) {
				r.classList.add("disabled");
			} else {
				r.classList.remove("disabled");
			}
		}

		function chkSelected() {
			var buttons = document.body.querySelectorAll("div.selection");
			var inputs = {
				index: document.getElementById("myIndex"),
				id: document.getElementById("myId"),
				x: document.getElementById("myX"),
				y: document.getElementById("myY"),
				width: document.getElementById("myWidth"),
				height: document.getElementById("myHeight"),
				rotate: document.getElementById("myRotate"),
				scaleX: document.getElementById("myFlipY"),
				scaleY: document.getElementById("myFlipX"),
				opacity: document.getElementById("myOpacity"),
				// lockAspectRatio: document.getElementById("myLockAspectRatio"),
				// editable: document.getElementById("myEditable"),
				// drawable: document.getElementById("myDrawable"),
			}
			if (selectedId) {
				canvaaas.getImage(selectedId, function(err, res){
					if (err) {return false;}
					inputs.index.innerHTML = "(" + Math.floor(res.index) + ")";
					inputs.id.innerHTML = res.id;
					inputs.x.innerHTML = Math.floor(res.x) + "px";
					inputs.y.innerHTML = Math.floor(res.y) + "px";
					inputs.width.innerHTML = Math.floor(res.width) + "px";
					inputs.height.innerHTML = Math.floor(res.height) + "px";
					inputs.rotate.innerHTML = Math.floor(res.rotate) + "deg";
					inputs.scaleX.innerHTML = res.scaleX === -1;
					inputs.scaleY.innerHTML = res.scaleY === -1;
					inputs.opacity.innerHTML = Math.floor(res.opacity);
					// if (!res.editable) {
					// 	inputs.editable.innerHTML = "Uneditabled";
					// 	inputs.editable.style.color = "red";
					// } else {
					// 	inputs.editable.innerHTML = "Editabled";
					// 	inputs.editable.style.color = "#FFFFFF";
					// }
					// if (!res.lockAspectRatio) {
					// 	inputs.lockAspectRatio.innerHTML = "Unlocked";
					// 	inputs.lockAspectRatio.style.color = "#FFFFFF";
					// } else {
					// 	inputs.lockAspectRatio.innerHTML = "Locked";
					// 	inputs.lockAspectRatio.style.color = "red";
					// }
					// if (!res.drawable) {
					// 	inputs.drawable.innerHTML = "Undrawbled";
					// 	inputs.drawable.style.color = "red";
					// } else {
					// 	inputs.drawable.innerHTML = "Drawbled";
					// 	inputs.drawable.style.color = "#FFFFFF";
					// }
				});

				buttons.forEach(function(elem){
					var btn = elem.querySelector("a");
					if (btn) {
						if (btn.classList.contains("disabled")) {
							btn.classList.remove("disabled");
						}
					}
				})
			} else {
				inputs.index.innerHTML = "(Index)";
				inputs.id.innerHTML = "ID";
				inputs.x.innerHTML = "X";
				inputs.y.innerHTML = "Y";
				inputs.width.innerHTML = "Width";
				inputs.height.innerHTML = "Height";
				inputs.rotate.innerHTML = "Rotate";
				inputs.scaleX.innerHTML = "FlipY";
				inputs.scaleY.innerHTML = "FlipX";
				inputs.opacity.innerHTML = "Opacity";
				// inputs.lockAspectRatio.innerHTML = "Lock Aspect Ratio";
				// inputs.lockAspectRatio.style.color = "#FFFFFF";
				// inputs.editable.innerHTML = "Editable";
				// inputs.editable.style.color = "#FFFFFF";
				// inputs.drawable.innerHTML = "Drawable";
				// inputs.drawable.style.color = "#FFFFFF";

				buttons.forEach(function(elem){
					var btn = elem.querySelector("a");
					if (btn) {
						if (!btn.classList.contains("disabled")) {
							btn.classList.add("disabled");
						}
					}
				})
			}
		}

		document.body.addEventListener("click", function(e) {
			var isTarget = e.target.tagName === "BODY" || e.target.classList.contains("canvaaas-canvas") || e.target.id === "target";
			// console.log(isTarget);
			if (!isTarget) {
				return false;
			}

			if (selectedId) {
				canvaaas.removeClass(selectedId, "selected");
				selectedId = undefined;
			}

			chkSelected()

			if (popup) {
				closePopup();
			}
		});

		chkCache();
		chkSelected();

		//
		// popup
		// 

		var popup;

		function createList(id, nam, method, val) {
			var t = "";
			t += "<div class='row'>";
			t += "<a href='javascript:void(0)'"
			t += "onclick='clickPopup(this)'";
			t += "data-id='"+id+"'";
			t += "data-method='"+method+"'";
			t += "data-value='"+val+"'";
			t += ">";
			t += nam;
			t += "</a>";
			t += "</div>";
			return t;
		}

		function clickPopup(self) {
			var m = self.getAttribute("data-method");
			var v = self.getAttribute("data-value");
			var id = self.getAttribute("data-id");
			switch(m) {
				case "cover":
					canvaaas.cover(id);
					break;
				case "contain":
					canvaaas.contain(id);
					break;
				case "rotate":
					canvaaas.rotate(id, v);
					break;
				case "zoom":
					canvaaas.zoom(id, v);
					break;
				case "flipX":
					canvaaas.flipX(id);
					break;
				case "flipY":
					canvaaas.flipY(id);
					break;
				case "clickable":
					canvaaas.clickable(id);
					break;
				case "editable":
					canvaaas.editable(id);
					break;
				case "drawable":
					canvaaas.drawable(id);
					break;
				case "remove":
					canvaaas.remove(id);
					break;
			}
			closePopup();
		}

		function openPopup(id, x, y) {
			if (popup) {
				closePopup();
			}

			var t = document.createElement("div");
			t.className = "popup";
			t.style = x + y;
			t.innerHTML += createList(id, "Cover", "cover", "");
			t.innerHTML += createList(id, "Contain", "contain", "");
			t.innerHTML += createList(id, "Rotate R", "rotate", "45");
			t.innerHTML += createList(id, "Rotate L", "rotate", "-45");
			t.innerHTML += createList(id, "Zoom in", "zoom", "1.1");
			t.innerHTML += createList(id, "Zoom out", "zoom", "0.9");
			t.innerHTML += createList(id, "Flip X", "flipX", "");
			t.innerHTML += createList(id, "Flip Y", "flipY", "");
			t.innerHTML += createList(id, "Clickable", "clickable", "");
			t.innerHTML += createList(id, "Editable", "editable", "");
			t.innerHTML += createList(id, "drawable", "drawable", "");
			t.innerHTML += createList(id, "Remove", "remove", "");

			document.body.appendChild(t);

			return t;
		}

		function closePopup() {
			popup.parentNode.removeChild(popup);
			popup = undefined;
		}


		// 
		// header
		// 

		(function(){
			var header = document.body.querySelector("div.header");
			var tabs = header.querySelectorAll("div.title");
			var isOpened = false;

			tabs.forEach(function(elem){
				elem.addEventListener("click", function(e){
					if (isOpened) {
						closeAll();
					}

					e.preventDefault();
					e.stopPropagation();

					openOne(this);

					document.addEventListener("click", function(e){
						if (isOpened) {
							closeAll();
						}
					});

				});
			})
			
			function closeAll() {
				tabs.forEach(function(elem){
					var list = elem.parentNode.querySelector("div.list");
					list.style.display = "none";
				});

				isOpened = false;
			}

			function openOne(elem) {
				var list = elem.parentNode.querySelector("div.list");
				list.style.display = "block";

				isOpened = true;
			}
		})();
	</script>
</body>

</html>